<!DOCTYPE html>
<html lang="en-IN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mono-Repos to the Rescue: Organizing and Archiving Old GitHub Projects | Animesh Sahu</title>
    <meta name="description" content="Declutterring the GitHub Profile">
    <meta name="generator" content="VitePress v1.3.4">
    <link rel="preload stylesheet" href="/site/assets/style.Dj7ZZD0q.css" as="style">
    
    <script type="module" src="/site/assets/app.CftIw-G3.js"></script>
    <link rel="modulepreload" href="/site/assets/chunks/framework.BIeOwSkr.js">
    <link rel="modulepreload" href="/site/assets/chunks/VPLocalSearchBox.D-QZJ9Ca.js">
    <link rel="modulepreload" href="/site/assets/blogs_mono-repos-archiving-github-projects.md.CGxJdy75.lean.js">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Klee+One:wght@600&amp;display=swap%22">
    <link rel="alternate" type="application/rss+xml" href="/site/rss.xml" title="Animesh Sahu | Sitewide RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="/site/atom.xml" title="Animesh Sahu | Sitewide Atom Feed">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a0af88ad><!--[--><!--]--><!--[--><span tabindex="-1" data-v-07f27c84></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-07f27c84> Skip to content </a><!--]--><!----><header class="VPNav" data-v-a0af88ad data-v-94b019dd><div class="VPNavBar" data-v-94b019dd data-v-6a61ff58><div class="wrapper" data-v-6a61ff58><div class="container" data-v-6a61ff58><div class="title" data-v-6a61ff58><div class="VPNavBarTitle" data-v-6a61ff58 data-v-f8ccd9b0><a class="title" href="/site/" data-v-f8ccd9b0><!--[--><!--]--><!----><span data-v-f8ccd9b0>Animesh Sahu / Home</span><!--[--><!--]--></a></div></div><div class="content" data-v-6a61ff58><div class="content-body" data-v-6a61ff58><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6a61ff58><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6a61ff58 data-v-d368eb94><span id="main-nav-aria-label" class="visually-hidden" data-v-d368eb94> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>üè† Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/blogs/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>üìù Blogs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/notes/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>üìî Notes</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/projects/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>üöÄ Projects</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/journal/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>‚úçüèª Journal</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6a61ff58 data-v-53f1d564><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-53f1d564 data-v-ead85328 data-v-fb57c1c6><span class="check" data-v-fb57c1c6><span class="icon" data-v-fb57c1c6><!--[--><span class="vpi-sun sun" data-v-ead85328></span><span class="vpi-moon moon" data-v-ead85328></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6a61ff58 data-v-ab886c99 data-v-9fbf789f><!--[--><a class="VPSocialLink no-icon" href="/site/atom.xml" aria-label target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rss" viewBox="0 0 16 16"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Animeshz/site" aria-label="github" target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6a61ff58 data-v-62d0ba9e data-v-b804da08><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b804da08><span class="vpi-more-horizontal icon" data-v-b804da08></span></button><div class="menu" data-v-b804da08><div class="VPMenu" data-v-b804da08 data-v-82d34753><!----><!--[--><!--[--><!----><div class="group" data-v-62d0ba9e><div class="item appearance" data-v-62d0ba9e><p class="label" data-v-62d0ba9e>Appearance</p><div class="appearance-action" data-v-62d0ba9e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-62d0ba9e data-v-ead85328 data-v-fb57c1c6><span class="check" data-v-fb57c1c6><span class="icon" data-v-fb57c1c6><!--[--><span class="vpi-sun sun" data-v-ead85328></span><span class="vpi-moon moon" data-v-ead85328></span><!--]--></span></span></button></div></div></div><div class="group" data-v-62d0ba9e><div class="item social-links" data-v-62d0ba9e><div class="VPSocialLinks social-links-list" data-v-62d0ba9e data-v-9fbf789f><!--[--><a class="VPSocialLink no-icon" href="/site/atom.xml" aria-label target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rss" viewBox="0 0 16 16"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Animeshz/site" aria-label="github" target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6a61ff58 data-v-fbc22365><span class="container" data-v-fbc22365><span class="top" data-v-fbc22365></span><span class="middle" data-v-fbc22365></span><span class="bottom" data-v-fbc22365></span></span></button></div></div></div></div><div class="divider" data-v-6a61ff58><div class="divider-line" data-v-6a61ff58></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-a0af88ad data-v-07a84835><div class="container" data-v-07a84835><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-07a84835 data-v-22d6e4e8><button data-v-22d6e4e8>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-a0af88ad data-v-3c531c71><div class="VPDoc has-aside" data-v-3c531c71 data-v-d037b72c><!--[--><!--]--><div class="container" data-v-d037b72c><div class="aside" data-v-d037b72c><div class="aside-curtain" data-v-d037b72c></div><div class="aside-container" data-v-d037b72c><div class="aside-content" data-v-d037b72c><div class="VPDocAside" data-v-d037b72c data-v-53740390><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-53740390 data-v-7c6fcd35><div class="content" data-v-7c6fcd35><div class="outline-marker" data-v-7c6fcd35></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-7c6fcd35>Table of Contents</div><ul class="VPDocOutlineItem root" data-v-7c6fcd35 data-v-5a646e56><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-53740390></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d037b72c><div class="content-container" data-v-d037b72c><!--[--><!--]--><main class="main" data-v-d037b72c><div style="position:relative;" class="vp-doc _site_blogs_mono-repos-archiving-github-projects" data-v-d037b72c><div><h1 id="mono-repos-to-the-rescue-organizing-and-archiving-old-github-projects" tabindex="-1">Mono-Repos to the Rescue: Organizing and Archiving Old GitHub Projects <a class="header-anchor" href="#mono-repos-to-the-rescue-organizing-and-archiving-old-github-projects" aria-label="Permalink to &quot;Mono-Repos to the Rescue: Organizing and Archiving Old GitHub Projects&quot;">‚Äã</a></h1><!----><p>Has your number of GitHub repos increased over time? And they all seem strong point of reference and you don&#39;t want to delete them? Let&#39;s dive into mono-repos for their safe and sound archival!</p><p><img src="/site/assets/poster.6s90tjW7.png" alt="Poster"></p><h2 id="mono-repos" tabindex="-1">Mono Repos <a class="header-anchor" href="#mono-repos" aria-label="Permalink to &quot;Mono Repos&quot;">‚Äã</a></h2><p>Mono Repos are not a direct component in version control systems like git by itself, rahter its just a concept of merging together multiple repositories into a single one for grouping them together, and they&#39;re getting popular now a days after a long time.</p><p><img src="/site/assets/example.j9Fham8s.png" alt="Example"></p><p>I&#39;ve recently moved most of my repositories that were either doing nothing (either prototypes or not-in-use or are just old) into a the public mono-repository <a href="https://github.com/Animeshz/archives-public" target="_blank" rel="noreferrer">Animeshz/archives-public</a> and a private one named archives-private.</p><h2 id="goals" tabindex="-1">Goals <a class="header-anchor" href="#goals" aria-label="Permalink to &quot;Goals&quot;">‚Äã</a></h2><p>Since mono repos are not a direct concept in git, a lot of guides or articles shows different ways of achieving this, and some are not good enough because saying something a mono repo can also be done by just copy pasting the repository and deleting its <code>.git</code> folder, which in my opinion loses a lot of information about it.</p><p>So I do have some design goals while doing it, namely,</p><ul><li>All the commits should be preserved as-is, with dates and authors.</li><li>The commits should be easily identifyable to which repository it belonged.</li><li>The repositories that will go into the mono-repo should have a designated directory of residence and should not clog other files and folders.</li></ul><h2 id="the-approach" tabindex="-1">The approach <a class="header-anchor" href="#the-approach" aria-label="Permalink to &quot;The approach&quot;">‚Äã</a></h2><p>I&#39;ve gone through many approaches ranging from <code>git rebase</code>, <code>git filter-branch</code>, <code>git env-filter</code> and many more, which I&#39;ll link in the end if you want to have a read, but I&#39;ll quickly wrap my approach and compare it with other approaches.</p><p>First of all, creating a repository which will be our mono-repo, with <a href="./github.new.html">https://github.new</a>, and cloning it as usual,</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> clone</span><span style="color:#C3E88D;"> https://github.com/Animeshz/archives-public</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Then each repository that has to be archived, we clone it with the specific branch,</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> clone</span><span style="color:#C3E88D;"> https://github.com/</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">use</span><span style="color:#BABED8;">r</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">repository-nam</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;"> --branch</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">branch-nam</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;">repository-nam</span><span style="color:#BABED8;">e</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>First, we&#39;ll make its history linear so that we can export the whole branch as patch with <code>git format-patch</code> later on. We&#39;ll do this by removing the merge diamond, that is created by canonical merges <a href="/site/blogs/using-git-for-effective-collaboration.html#situations-on-merge">see my previous article</a>, which can be done by rebase.</p><p>This can be done by <code>git rebase</code> which will rewrite the history by applying commit one after another chronologically,</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> rebase</span><span style="color:#C3E88D;"> --root</span><span style="color:#C3E88D;"> -X</span><span style="color:#C3E88D;"> theirs</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> merge</span><span style="color:#C3E88D;"> --ff</span><span style="color:#89DDFF;"> $(</span><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> commit-tree</span><span style="color:#C3E88D;"> remotes/origin/</span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">BRANCH</span><span style="color:#89DDFF;">:-</span><span style="color:#BABED8;">HEAD</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">^{tree}</span><span style="color:#C3E88D;"> -m</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Fix after making history linear</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> -p</span><span style="color:#C3E88D;"> HEAD</span><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>The <code>-X theirs</code> accepts the merger branch&#39;s changes as <code>git merge</code> happens to do to keep the merge diamond, and then make a merge commit which accounts for the conflict resolution, here we do something similar, we accept theirs and then whatever delta we see from the rebase completion to the original state of the repository were, we apply it with a fast forward merge. Effectively making our history linear.</p><p><img src="/site/assets/rebase-demo.BBvuE1j5.png" alt="Rebase Demo"></p><p>Now, we can proceed with our main logic, rewriting history such that the whole repo is contained in a directory as well as renaming commits such that they&#39;re identifyable to be part of current repo,</p><p>We can do this by <code>git filter-branch</code> and <code>git env-filter</code>, but <code>git filter-branch</code> when ran, itself suggests the use of <a href="https://github.com/newren/git-filter-repo" target="_blank" rel="noreferrer">newren/git-filter-repo</a>. So we&#39;ll go with suggested method.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">nix</span><span style="color:#C3E88D;"> profile</span><span style="color:#C3E88D;"> install</span><span style="color:#C3E88D;"> nixpkgs#git-filter-repo</span><span style="color:#676E95;font-style:italic;">  # or by your package-manager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">NAME</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#C3E88D;">repo-name</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> filter-repo</span><span style="color:#C3E88D;"> --replace-message</span><span style="color:#89DDFF;"> &lt;(</span><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">regex:^==&gt;[</span><span style="color:#BABED8;">$NAME</span><span style="color:#C3E88D;">] </span><span style="color:#89DDFF;">&quot;)</span><span style="color:#C3E88D;"> --path-rename</span><span style="color:#C3E88D;"> :</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">$NAME</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This should move all the files into subdirectory going by name <code>$NAME</code> rewriting the commit history, also prefixing each commit message by <code>[$NAME] </code>.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>While almost all the inbuilt git commands allows you reverting changes, this command repacks the git objects and garbage collect immediately, thus loosing the ability to go back with <code>git reflog</code>, if you don&#39;t want this behavior you can pass <code>--partial</code> to not garbage collect in the end.<br>See <a href="https://htmlpreview.github.io/?https://github.com/newren/git-filter-repo/blob/docs/html/git-filter-repo.html" target="_blank" rel="noreferrer">docs</a> for more info.</p></div><p>For instance for repo named <code>overengineered-pastebin</code>, something like this will happen:</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span>$ git log --format=fuller -p</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>commit 3520a5c93bb65103f23532d4d37ffcc33c727587</span></span>
<span class="line"><span>Author:     Animesh Sahu &lt;animeshsahu19@yahoo.com&gt;</span></span>
<span class="line"><span>AuthorDate: Fri Nov 4 12:03:22 2022 +0530</span></span>
<span class="line"><span>Commit:     Animesh Sahu &lt;animeshsahu19@yahoo.com&gt;</span></span>
<span class="line"><span>CommitDate: Fri Nov 4 12:03:22 2022 +0530</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    [overengineered-pastebin] Your commit message</span></span>
<span class="line"><span></span></span>
<span class="line"><span>diff --git a/overengineered-pastebin/frontend/src/components/LanguageSelektor.vue b/overengineered-pastebin/frontend/src/components/LanguageSelektor.vue</span></span>
<span class="line"><span>...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Now the only thing remaining to do is to export the commits and import them into our mono-repo,</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> format-patch</span><span style="color:#C3E88D;"> -k</span><span style="color:#C3E88D;"> --no-stat</span><span style="color:#C3E88D;"> --stdout</span><span style="color:#C3E88D;"> --root</span><span style="color:#C3E88D;"> HEAD</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> my.patch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#C3E88D;"> /path/to/archives-public/</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> am</span><span style="color:#C3E88D;"> -k</span><span style="color:#C3E88D;"> -3</span><span style="color:#C3E88D;"> --committer-date-is-author-date</span><span style="color:#C3E88D;"> --empty=drop</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/path/to/archiving/repo/my.patch</span><span style="color:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This should super-impose the new repo contained in a designated directory by previous commands with the mono-repo by applying the commits from the repo that is to be archived.</p><h2 id="final-script" tabindex="-1">Final Script <a class="header-anchor" href="#final-script" aria-label="Permalink to &quot;Final Script&quot;">‚Äã</a></h2><p>I&#39;ve turned this into an interactive script by using <a href="https://github.com/charmbracelet/gum" target="_blank" rel="noreferrer">charmbracelet/gum</a>.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">MONOREPO</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#FFCB6B;">realpath</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#BABED8;font-style:italic;">$1</span><span style="color:#89DDFF;">&quot;)&quot;</span></span>
<span class="line"><span style="color:#BABED8;">REPO</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#FFCB6B;">gum</span><span style="color:#C3E88D;"> input --placeholder </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Repository URL</span><span style="color:#89DDFF;">&quot;)&quot;</span></span>
<span class="line"><span style="color:#BABED8;">BRANCH</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#FFCB6B;">gum</span><span style="color:#C3E88D;"> input --placeholder </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Branch (empty for default)</span><span style="color:#89DDFF;">&quot;)&quot;</span></span>
<span class="line"><span style="color:#BABED8;">NAME</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#FFCB6B;">gum</span><span style="color:#C3E88D;"> input --placeholder </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Custom name of subrepo</span><span style="color:#89DDFF;">&quot;)&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">NAME</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;${</span><span style="color:#BABED8;">NAME</span><span style="color:#89DDFF;">:-${</span><span style="color:#BABED8;">REPO</span><span style="color:#89DDFF;">##*/}}&quot;</span></span>
<span class="line"><span style="color:#BABED8;">NAME</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;${</span><span style="color:#BABED8;">NAME</span><span style="color:#89DDFF;">%</span><span style="color:#C3E88D;">.</span><span style="color:#BABED8;">git</span><span style="color:#89DDFF;">}&quot;</span></span>
<span class="line"><span style="color:#BABED8;">options</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;"> [[</span><span style="color:#89DDFF;"> -n</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#BABED8;">$BRANCH</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> ]];</span><span style="color:#89DDFF;font-style:italic;"> then</span></span>
<span class="line"><span style="color:#BABED8;">    options</span><span style="color:#89DDFF;">+=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-b </span><span style="color:#BABED8;">$BRANCH</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[[</span><span style="color:#89DDFF;"> -d</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/tmp/</span><span style="color:#BABED8;">$NAME</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> ]]</span><span style="color:#89DDFF;"> &amp;&amp;</span><span style="color:#FFCB6B;"> gum</span><span style="color:#C3E88D;"> confirm</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Delete directory /tmp/</span><span style="color:#BABED8;">$NAME</span><span style="color:#C3E88D;"> (already exists)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> &amp;&amp;</span><span style="color:#FFCB6B;"> rm</span><span style="color:#C3E88D;"> -rf</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/tmp/</span><span style="color:#BABED8;">$NAME</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> clone</span><span style="color:#BABED8;"> $options </span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">$REPO</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/tmp/</span><span style="color:#BABED8;">$NAME</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/tmp/</span><span style="color:#BABED8;">$NAME</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> rebase</span><span style="color:#C3E88D;"> --root</span><span style="color:#C3E88D;"> -X</span><span style="color:#C3E88D;"> theirs</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> merge</span><span style="color:#C3E88D;"> --ff</span><span style="color:#89DDFF;"> $(</span><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> commit-tree</span><span style="color:#C3E88D;"> remotes/origin/</span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">BRANCH</span><span style="color:#89DDFF;">:-</span><span style="color:#BABED8;">HEAD</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">^{tree}</span><span style="color:#C3E88D;"> -m</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Fix after making history linear</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> -p</span><span style="color:#C3E88D;"> HEAD</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> filter-repo</span><span style="color:#C3E88D;"> --replace-message</span><span style="color:#89DDFF;"> &lt;(</span><span style="color:#82AAFF;">echo</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">regex:^==&gt;[</span><span style="color:#BABED8;">$NAME</span><span style="color:#C3E88D;">] </span><span style="color:#89DDFF;">&quot;)</span><span style="color:#C3E88D;"> --path-rename</span><span style="color:#C3E88D;"> :</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">$NAME</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/</span><span style="color:#C3E88D;"> -f</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> format-patch</span><span style="color:#C3E88D;"> -k</span><span style="color:#C3E88D;"> --no-stat</span><span style="color:#C3E88D;"> --stdout</span><span style="color:#C3E88D;"> --root</span><span style="color:#C3E88D;"> HEAD</span><span style="color:#89DDFF;"> &gt;</span><span style="color:#C3E88D;"> my.patch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> $MONOREPO </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#FFCB6B;"> git</span><span style="color:#C3E88D;"> am</span><span style="color:#C3E88D;"> -k</span><span style="color:#C3E88D;"> -3</span><span style="color:#C3E88D;"> --committer-date-is-author-date</span><span style="color:#C3E88D;"> --empty=drop</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">/tmp/</span><span style="color:#BABED8;">$NAME</span><span style="color:#C3E88D;">/my.patch</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">gum</span><span style="color:#C3E88D;"> confirm</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Delete cloned repo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> &amp;&amp;</span><span style="color:#FFCB6B;"> rm</span><span style="color:#C3E88D;"> -rf</span><span style="color:#C3E88D;"> /tmp/</span><span style="color:#BABED8;">$NAME</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">‚Äã</a></h2><p>I&#39;ve crunched down 110+ repositories on my github profile into bare 26, splitting them into archives-public and archives-private, removing stale forks in between as well. This let me clean up the profile for an ergonomic view into it.</p><p><img src="/site/assets/repo-ss.G-FvEtCU.jpg" alt="Repo Final"></p><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">‚Äã</a></h2><ol><li>Rebase way of doing it (way too slow), <ul><li><a href="https://stackoverflow.com/a/73314321/11377112" target="_blank" rel="noreferrer">https://stackoverflow.com/a/73314321/11377112</a></li><li><a href="https://stackoverflow.com/a/69551810/11377112" target="_blank" rel="noreferrer">https://stackoverflow.com/a/69551810/11377112</a></li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#C3E88D;"> -c</span><span style="color:#C3E88D;"> rebase.instructionFormat=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%s%nexec GIT_COMMITTER_DATE=&quot;%cD&quot; GIT_AUTHOR_DATE=&quot;%aD&quot; git commit --amend -m &quot;bhao bhao: $(git show -s --format=%%s)&quot;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> rebase</span><span style="color:#C3E88D;"> -i</span><span style="color:#C3E88D;"> --root</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li>Manual patching with sed <ul><li><a href="https://medium.com/@TimHolzherr/how-to-move-your-git-repository-into-a-monorepo-without-loosing-its-history-9b9d2da27155" target="_blank" rel="noreferrer">https://medium.com/@TimHolzherr/how-to-move-your-git-repository-into-a-monorepo-without-loosing-its-history-9b9d2da27155</a></li></ul></li><li>Using <code>git filter-branch</code><ul><li><a href="https://leyanlo.medium.com/how-to-move-one-git-repository-into-a-subdirectory-of-another-with-rebase-2b297b628c57" target="_blank" rel="noreferrer">https://leyanlo.medium.com/how-to-move-one-git-repository-into-a-subdirectory-of-another-with-rebase-2b297b628c57</a>.</li></ul></li><li>Git filter-repo manual <ul><li><a href="https://htmlpreview.github.io/?https://github.com/newren/git-filter-repo/blob/docs/html/git-filter-repo.html" target="_blank" rel="noreferrer">https://htmlpreview.github.io/?https://github.com/newren/git-filter-repo/blob/docs/html/git-filter-repo.html</a></li></ul></li></ol><h2 id="further-reading" tabindex="-1">Further Reading <a class="header-anchor" href="#further-reading" aria-label="Permalink to &quot;Further Reading&quot;">‚Äã</a></h2><p>Backlinks</p><ul><li><a href="https://www.reddit.com/r/github/comments/1bei6h6/monorepos_to_the_rescue_organizing_and_archiving" target="_blank" rel="noreferrer">r/github</a></li><li><a href="https://news.ycombinator.com/item?id=39702247" target="_blank" rel="noreferrer">HN</a></li><li><a href="https://www.linkedin.com/posts/animeshz_mono-repos-to-the-rescue-organizing-and-activity-7173990964946956288-0lQg" target="_blank" rel="noreferrer">LinkedIn</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-d037b72c data-v-eba3502e><!--[--><!--]--><div class="edit-info" data-v-eba3502e><div class="edit-link" data-v-eba3502e><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Animeshz/site/edit/main/content/blogs/mono-repos-archiving-github-projects.md" target="_blank" rel="noreferrer" data-v-eba3502e><!--[--><span class="vpi-square-pen edit-link-icon" data-v-eba3502e></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-eba3502e><p class="VPLastUpdated" data-v-eba3502e data-v-5eaa2aa0>Last updated: <time datetime="2024-11-04T15:14:36.000Z" data-v-5eaa2aa0></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><div class="prev-next" data-v-51d10272><div class="pager" data-v-51d10272><a class="pager-link prev" href="/site/blogs/binfmt.html" data-v-51d10272><span class="desc" data-v-51d10272>Previous page</span><span class="title" data-v-51d10272>BinFmt: The hidden secret of runtime execution</span></a></div><div class="has-prev pager" data-v-51d10272><a class="pager-link next" href="/site/blogs/chasing-productivity-1.html" data-v-51d10272><span class="desc" data-v-51d10272>Next page</span><span class="title" data-v-51d10272>Chasing productivity - Part 1: The nixification saga</span></a></div></div><div id="gitalk-container"></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blogs_a-critical-analysis-of-linux-landscape.md\":\"VhsB2tiM\",\"blogs_binfmt.md\":\"0_nzuNNy\",\"blogs_chasing-productivity-1.md\":\"CKRZ2xgi\",\"blogs_creating-yet-another-distribution-zxcv-linux-1.md\":\"D87phBn5\",\"blogs_demystifying-uefi.md\":\"Df8AIGhA\",\"blogs_git.md\":\"B6ZfJ_pY\",\"blogs_index.md\":\"Cqf97ZnO\",\"blogs_linux-1.md\":\"mtZ1BQSH\",\"blogs_linux-2.md\":\"k2G5cG7U\",\"blogs_ml-tldr.md\":\"sYGSzW7T\",\"blogs_mono-repos-archiving-github-projects.md\":\"CGxJdy75\",\"blogs_using-git-for-effective-collaboration.md\":\"C_rbKO14\",\"blogs_void-linux.md\":\"DFzZChhA\",\"blogs_working-with-binaries.md\":\"D-msfRms\",\"index.md\":\"CQygY5mH\",\"journal_2023_july.md\":\"ChXi7LIv\",\"journal_2023_june.md\":\"ZY0Xvti_\",\"journal_index.md\":\"DKBlbNED\",\"notes_20-29--devenvironment_21--linux_21.01-zfs.md\":\"BHrvpFfZ\",\"notes_20-29--devenvironment_21--linux_21.02-nix.md\":\"ik_PCM5_\",\"notes_20-29--devenvironment_21--linux_21.03-cli-utilities.md\":\"BcDbxLhA\",\"notes_20-29--devenvironment_22--text-editors_22.01-emacs.md\":\"BBnTO4AZ\",\"notes_90-99--miscellaneous_91--curation_91.01-note-taking.md\":\"CBOA__xd\",\"notes_90-99--miscellaneous_91--curation_91.02-awesome-resources.md\":\"DHg9_Jal\",\"notes_90-99--miscellaneous_91--curation_91.03-awesome-projects.md\":\"_IARyxSh\",\"notes_90-99--miscellaneous_92--learnings_92.01-counter-intuitive.md\":\"DHZzjN8h\",\"notes_90-99--miscellaneous_92--learnings_92.02-out-of-box.md\":\"CyTju0R2\",\"notes_90-99--miscellaneous_92--learnings_92.03-health.md\":\"DMIzsRfz\",\"notes_index.md\":\"DQuDX1xH\",\"projects_index.md\":\"OqVp39_s\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-IN\",\"dir\":\"ltr\",\"title\":\"Animesh Sahu\",\"description\":\"I write about wide-variety of untouched topics in a simplified way.\",\"base\":\"/site/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"Animesh Sahu / Home\",\"search\":{\"provider\":\"local\"},\"outline\":[2,6],\"outlineTitle\":\"Table of Contents\",\"socialLinks\":[{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-rss\\\" viewBox=\\\"0 0 16 16\\\"><path d=\\\"M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z\\\"/></svg>\"},\"link\":\"/site/atom.xml\"},{\"icon\":\"github\",\"link\":\"https://github.com/Animeshz/site\"}],\"editLink\":{\"pattern\":\"https://github.com/Animeshz/site/edit/main/content/:path\"},\"nav\":[{\"text\":\"üè† Home\",\"link\":\"/\"},{\"text\":\"üìù Blogs\",\"link\":\"/blogs/\"},{\"text\":\"üìî Notes\",\"link\":\"/notes/\"},{\"text\":\"üöÄ Projects\",\"link\":\"/projects/\"},{\"text\":\"‚úçüèª Journal\",\"link\":\"/journal/\"}],\"sidebar\":{\"/notes/\":[{\"text\":\"20-29--DevEnvironment\",\"items\":[{\"text\":\"<span style=\\\"font-weight: 700;\\\">21--Linux</span>\",\"items\":[{\"text\":\"21.01-ZFS\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.01-ZFS\"},{\"text\":\"21.02-Nix\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.02-Nix\"},{\"text\":\"21.03-Cli-Utilities\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.03-Cli-Utilities\"}]},{\"text\":\"<span style=\\\"font-weight: 700;\\\">22--Text-Editors</span>\",\"items\":[{\"text\":\"22.01-Emacs\",\"link\":\"/notes/20-29--DevEnvironment/22--Text-Editors/22.01-Emacs\"}]}]},{\"text\":\"90-99--Miscellaneous\",\"items\":[{\"text\":\"<span style=\\\"font-weight: 700;\\\">91--Curation</span>\",\"items\":[{\"text\":\"91.01-Note-Taking\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.01-Note-Taking\"},{\"text\":\"91.02-Awesome-Resources\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.02-Awesome-Resources\"},{\"text\":\"91.03-Awesome-Projects\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.03-Awesome-Projects\"}]},{\"text\":\"<span style=\\\"font-weight: 700;\\\">92--Learnings</span>\",\"items\":[{\"text\":\"92.01-Counter-Intuitive\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.01-Counter-Intuitive\"},{\"text\":\"92.02-Out-Of-Box\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.02-Out-Of-Box\"},{\"text\":\"92.03-Health\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.03-Health\"}]}]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>