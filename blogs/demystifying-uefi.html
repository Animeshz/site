<!DOCTYPE html>
<html lang="en-IN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Demystifying UEFI | Animesh Sahu</title>
    <meta name="description" content="Easily understand everything you're missing about UEFI">
    <link rel="preload stylesheet" href="/site/assets/style.9b097e31.css" as="style">
    
    <script type="module" src="/site/assets/app.ac1bf3f6.js"></script>
    <link rel="preload" href="/site/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/site/assets/chunks/framework.7446e1aa.js">
    <link rel="modulepreload" href="/site/assets/chunks/theme.7e311419.js">
    <link rel="modulepreload" href="/site/assets/blogs_demystifying-uefi.md.cd8f85f0.lean.js">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Klee+One:wght@600&amp;display=swap%22">
    <link rel="alternate" type="application/rss+xml" href="/site/rss.xml" title="Animesh Sahu | Sitewide RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="/site/atom.xml" title="Animesh Sahu | Sitewide Atom Feed">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-9f53da12><!--[--><!--]--><!--[--><span tabindex="-1" data-v-6adecf08></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-6adecf08> Skip to content </a><!--]--><!----><header class="VPNav" data-v-9f53da12 data-v-3eaeeb12><div class="VPNavBar" data-v-3eaeeb12 data-v-fd97fd45><div class="container" data-v-fd97fd45><div class="title" data-v-fd97fd45><div class="VPNavBarTitle" data-v-fd97fd45 data-v-3215d495><a class="title" href="/site/" data-v-3215d495><!--[--><!--]--><!----><!--[-->Animesh Sahu / Home<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-fd97fd45><div class="curtain" data-v-fd97fd45></div><div class="content-body" data-v-fd97fd45><!--[--><!--]--><div class="VPNavBarSearch search" data-v-fd97fd45><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-fd97fd45 data-v-25195b31><span id="main-nav-aria-label" class="visually-hidden" data-v-25195b31>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/" tabindex="0" data-v-25195b31 data-v-5c9abb1f><!--[--><span data-v-5c9abb1f>🏠 Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/blogs/" tabindex="0" data-v-25195b31 data-v-5c9abb1f><!--[--><span data-v-5c9abb1f>📝 Blogs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/notes/" tabindex="0" data-v-25195b31 data-v-5c9abb1f><!--[--><span data-v-5c9abb1f>📔 Notes</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/projects/" tabindex="0" data-v-25195b31 data-v-5c9abb1f><!--[--><span data-v-5c9abb1f>🚀 Projects</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/journal/" tabindex="0" data-v-25195b31 data-v-5c9abb1f><!--[--><span data-v-5c9abb1f>✍🏻 Journal</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-fd97fd45 data-v-35d7cc8c><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-35d7cc8c data-v-3796519b data-v-4b1b2a9b><span class="check" data-v-4b1b2a9b><span class="icon" data-v-4b1b2a9b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3796519b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3796519b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-fd97fd45 data-v-34c69feb data-v-9df0a34d><!--[--><a class="VPSocialLink no-icon" href="/site/atom.xml" aria-label target="_blank" rel="noopener" data-v-9df0a34d data-v-0b6d72b9><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rss" viewBox="0 0 16 16"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Animeshz/site" aria-label="github" target="_blank" rel="noopener" data-v-9df0a34d data-v-0b6d72b9><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-fd97fd45 data-v-2be127c6 data-v-836a85f6><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-836a85f6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-836a85f6><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-836a85f6><div class="VPMenu" data-v-836a85f6 data-v-3d8d06cc><!----><!--[--><!--[--><!----><div class="group" data-v-2be127c6><div class="item appearance" data-v-2be127c6><p class="label" data-v-2be127c6>Appearance</p><div class="appearance-action" data-v-2be127c6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-2be127c6 data-v-3796519b data-v-4b1b2a9b><span class="check" data-v-4b1b2a9b><span class="icon" data-v-4b1b2a9b><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-3796519b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-3796519b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-2be127c6><div class="item social-links" data-v-2be127c6><div class="VPSocialLinks social-links-list" data-v-2be127c6 data-v-9df0a34d><!--[--><a class="VPSocialLink no-icon" href="/site/atom.xml" aria-label target="_blank" rel="noopener" data-v-9df0a34d data-v-0b6d72b9><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rss" viewBox="0 0 16 16"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Animeshz/site" aria-label="github" target="_blank" rel="noopener" data-v-9df0a34d data-v-0b6d72b9><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-fd97fd45 data-v-e60fa36a><span class="container" data-v-e60fa36a><span class="top" data-v-e60fa36a></span><span class="middle" data-v-e60fa36a></span><span class="bottom" data-v-e60fa36a></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav fixed reached-top" data-v-9f53da12 data-v-5356aad0><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-5356aad0 data-v-89d30736><button data-v-89d30736>Return to top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-v-9f53da12 data-v-985615c6><div class="VPDoc has-aside" data-v-985615c6 data-v-7d2be7d2><!--[--><!--]--><div class="container" data-v-7d2be7d2><div class="aside" data-v-7d2be7d2><div class="aside-curtain" data-v-7d2be7d2></div><div class="aside-container" data-v-7d2be7d2><div class="aside-content" data-v-7d2be7d2><div class="VPDocAside" data-v-7d2be7d2 data-v-cca0b9b7><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-cca0b9b7 data-v-970191a8><div class="content" data-v-970191a8><div class="outline-marker" data-v-970191a8></div><div class="outline-title" role="heading" aria-level="2" data-v-970191a8>Table of Contents</div><nav aria-labelledby="doc-outline-aria-label" data-v-970191a8><span class="visually-hidden" id="doc-outline-aria-label" data-v-970191a8> Table of Contents for current page </span><ul class="root" data-v-970191a8 data-v-a42e02b1><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cca0b9b7></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7d2be7d2><div class="content-container" data-v-7d2be7d2><!--[--><!--]--><!----><main class="main" data-v-7d2be7d2><div style="position:relative;" class="vp-doc _site_blogs_demystifying-uefi" data-v-7d2be7d2><div><h1 id="frontmatter-title" tabindex="-1">Demystifying UEFI <a class="header-anchor" href="#frontmatter-title" aria-label="Permalink to &quot;{{ $frontmatter.title }}&quot;">​</a></h1><!----><p><img src="/site/assets/processor-chip.1de84aef.jpg" alt="Cover Image"></p><p><strong>Today</strong> I did something really cool, made UKI (in the article) after few weeks of attempt.</p><p>Has this ever happened to you? After a long time, errors seem to go away and <em>everything starts working again</em>. Its such a nice feeling.</p><p>As an occassional low-level programming enjoyer, it feels really nice to work with something that you use everyday but are unaware of how it really works under the hood.</p><p>Let me show it by example, <em>sqaure root</em>, a simple thing right? How does it look in code, more simply how do you calculate it except just hit n trial? Computer does it in a deterministic way. Although I needed atleast 25-30 jump-to-definitions in Java&#39;s source code to find out how it actually worked. And simplified, its as simple as:</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">double</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">sqrt</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">double</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">n</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">double</span><span style="color:#BABED8;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> n</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">  // TBH anything, really, except 0 ofc.</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;">&lt;</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">++)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    a </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.5</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">a </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> n</span><span style="color:#89DDFF;">/</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> a</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>What the ƒυ¢к? Weren&#39;t we trying to calculate n to the power of 1/2? Really we do, but we can write the equation of power 1/2 in linear form (power 1). Now for those interested in how does this work, refer <a href="https://en.wikipedia.org/wiki/Newton%27s_method#Description" target="_blank" rel="noreferrer">Newton&#39;s Method</a>, its really simple.</p><p>The point is, exploring 25-30 definition jumps was worth it in the end!</p><p><em>UEFI</em> is quite similar too, its something that we use every single day, yet we&#39;re mostly unaware of how it works, and hence the curious boy will do everything to unravel the mystery.</p><h2 id="fundamentals-about-computers" tabindex="-1">Fundamentals about computers <a class="header-anchor" href="#fundamentals-about-computers" aria-label="Permalink to &quot;Fundamentals about computers&quot;">​</a></h2><p>I recently saw a video <a href="https://youtu.be/ZSSNFkEMv24" target="_blank" rel="noreferrer">What is voltage? (joke video)</a> posted on the April fools day, questioning why did it take you 5 years to fully understand the voltage. Its really funny one, I&#39;d encourage you to check it out. Its really feels daunting when society makes it difficult, by telling partial-statements and incrementally correct it out with time while not telling the most obvious truth.</p><p>It may seem a bit <em>boring</em>, maybe. But the way we want to start demystifying UEFI is by looking at the most obvious truth about computers.</p><p>That computers are made up of little switches (also known as transistors). When we press the power button, we let some electricity flow into the BIOS/CMOS chip for a short duration of time. These chips generally contains an EPROM (Erasable Programmable Read-Only Memory) which is flashed with something called as a firmware-descriptor (fd) through some equipments externally.</p><p>With a small flow of electricity, the firmware-descriptor present (which also contains the UEFI screen you see by pressing f2/f10 at the boot time), in the chip starts the booting sequence, by opening some gate and activating DRAM, then CPU then rest of the components.</p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Efi-simple.svg/1200px-Efi-simple.svg.png" width="40%" style="margin:auto;"><p>Once the RAM and the CPU is functional for the first time, it scans all the vFAT partitions in the connected drives and start looking for <code>/EFI/*/*.efi</code> files. Once it finds one, it tries to launch and give full hardware control to it.</p><h2 id="the-efi-file" tabindex="-1">The *.efi file <a class="header-anchor" href="#the-efi-file" aria-label="Permalink to &quot;The \*.efi file&quot;">​</a></h2><p>This one&#39;s really <em>interesting</em>. When your computer has just started off, it knows nothing about what to do, and this is the first file that tells it what to do.</p><p>In contrast, the *.efi file is just a simple binary, except that a few restrictions have been imposed by the <a href="https://uefi.org/sites/default/files/resources/UEFI%20Spec%202.8B%20May%202020.pdf" target="_blank" rel="noreferrer">UEFI Specifications</a>, namely the binary must use Microsoft ABI, be position independent, and the binary format should be PE32+ (self-contained) not the regular ELF (OS-dependent) that we use.</p><p>If we understand even a bit of it, we know that we need to build a binary targeting Microsoft Windows, and it doesn&#39;t use any of standard libraries (since there&#39;s no OS).</p><p>So let&#39;s just make a Hello World efi binary, because,</p><div class="quote" data-v-0d7e63f3><!--[-->Theory and practice sometimes clash. And when that happens, theory loses.<br>Every single time.<!--]--><p style="text-align:right;" data-v-0d7e63f3>- Linus Torvalds</p></div><h3 id="efi-programming-model" tabindex="-1">EFI Programming Model <a class="header-anchor" href="#efi-programming-model" aria-label="Permalink to &quot;EFI Programming Model&quot;">​</a></h3><p>Before we begin, we first have to know a few things,</p><ul><li>We can&#39;t use any of the standard headers that depend on the OS, not even <code>iostream</code> or <code>stdio.h</code>.</li><li>UEFI fd exposes a few functionalities by giving our efi entrypoint two parameters, that are pointer of <code>EFI_HANDLE</code> and <code>EFI_SYSTEM_TABLE</code>. The one that is useful to us is the latter one, it&#39;ll let us write to the console.</li><li>LLVM/Clang compiler toolchain (clang+lld) provides built-in support for cross-compilation (otherwise we&#39;d have to <a href="https://github.com/Animeshz/mainstream-cross-compilers" target="_blank" rel="noreferrer">compile gcc targeting windows</a> and even after that we&#39;d have to tell it to use Microsoft ABI at link-time).</li></ul><h3 id="hello-world-in-efi" tabindex="-1">Hello World in EFI <a class="header-anchor" href="#hello-world-in-efi" aria-label="Permalink to &quot;Hello World in EFI&quot;">​</a></h3><p>First let&#39;s install the dependencies we&#39;d require to build our first EFI code:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xbps-install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">clang</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">lld</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Here&#39;s a basic <code>Makefile</code> setup for compiling our first EFI code.</p><div class="language-make line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">make</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">CC </span><span style="color:#89DDFF;">:=</span><span style="color:#BABED8;"> clang</span></span>
<span class="line"><span style="color:#BABED8;">LD </span><span style="color:#89DDFF;">:=</span><span style="color:#BABED8;"> lld</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">CFLAGS </span><span style="color:#89DDFF;">:=</span><span style="color:#BABED8;"> -ffreestanding -MMD -mno-red-zone -std=c11 -target x86_64-unknown-windows</span></span>
<span class="line"><span style="color:#BABED8;">LDFLAGS </span><span style="color:#89DDFF;">:=</span><span style="color:#BABED8;"> -flavor link -subsystem:efi_application -entry:efi_main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">default</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> all clean</span></span>
<span class="line"><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> main.efi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">%.o</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> %.c</span></span>
<span class="line"><span style="color:#BABED8;">	</span><span style="color:#89DDFF;">$(</span><span style="color:#BABED8;">CC</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#BABED8;">CFLAGS</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> -c $&lt; -o $@</span></span>
<span class="line"><span style="color:#82AAFF;">%.efi</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> %.o</span></span>
<span class="line"><span style="color:#BABED8;">	</span><span style="color:#89DDFF;">$(</span><span style="color:#BABED8;">LD</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#BABED8;">LDFLAGS</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> $&lt; -out:$@</span></span>
<span class="line"><span style="color:#82AAFF;">clean</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">	rm -fv *.o *.d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">.PHONY</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> clean all default</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Let&#39;s open up <code>main.c</code> now and define out entry point,</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdint.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#C792EA;">uint64_t</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">efi_main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">void</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">*</span><span style="color:#BABED8;font-style:italic;">handle</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">void</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">*</span><span style="color:#BABED8;font-style:italic;">system_table</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>and run <code>make</code>, it should produce a <code>main.efi</code> file, and we can run <code>file main.efi</code> to ensure its metadata are as expected.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">make</span></span>
<span class="line"><span style="color:#FFCB6B;">clang</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-ffreestanding</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-MMD</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-mno-red-zone</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-std=c11</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-target</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">x86_64-unknown-windows</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-c</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main.c</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main.o</span></span>
<span class="line"><span style="color:#FFCB6B;">lld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-flavor</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">link</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-subsystem:efi_application</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-entry:efi_main</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main.o</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-out:main.efi</span></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-fv</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;">*</span><span style="color:#C3E88D;">.o</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;">*</span><span style="color:#C3E88D;">.d</span></span>
<span class="line"><span style="color:#FFCB6B;">removed</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">main.o</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#FFCB6B;">removed</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">main.d</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">file</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main.efi</span></span>
<span class="line"><span style="color:#FFCB6B;">main.efi:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">PE32+</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">executable</span><span style="color:#BABED8;"> (EFI </span><span style="color:#C3E88D;">application</span><span style="color:#BABED8;">) x86-64, </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> MS Windows</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="making-a-test-environment" tabindex="-1">Making a test environment <a class="header-anchor" href="#making-a-test-environment" aria-label="Permalink to &quot;Making a test environment&quot;">​</a></h3><p>Till now, everything seems great, although I don&#39;t think its a good idea to just throw the efi file to the <code>/boot/efi</code> and start booting your laptop/pc from it.</p><p>A better approach would be to spin up a small qemu vm and run the efi image/binary from there.</p><p>First let&#39;s install the dependencies:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xbps-install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">qemu</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Now we spin up a new qemu vm with current directory serving as a root filesystem to the vm:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">qemu-system-x86_64</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-drive</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">if=pflash,format=raw,readonly,file=/usr/share/qemu/edk2-x86_64-code.fd</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-drive</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">format=raw,file=fat:rw:</span><span style="color:#BABED8;">$PWD \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-net</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">none</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-nographic</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The important options are the two <code>-drive</code> options, first tells the VM to use the edk2 firmware-descriptor as UEFI (similar to one flashed on to your EPROM in the BIOS chip), the second mounts current directory (<code>$PWD</code>) as a vFAT filesystem in the VM.</p><p>Rest of options are just personal preference, <code>-net none</code> tells to not provide any network access to the vm, <code>-nographic</code> tells qemu can occupy our current terminal instead of a new graphical window (its convenient as I&#39;m majorly a keyboard-centric guy).</p><p>This should drop you to a EFI shell, to load your efi file, run the following:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Shell&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">fs0:</span></span>
<span class="line"><span style="color:#FFCB6B;">fs0:\&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main.efi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>It outputs nothing, and that&#39;s good thing because there were no errors, hence everything worked perfectly!</p><h3 id="hello-world-in-efi-continue" tabindex="-1">Hello World in EFI (continue) <a class="header-anchor" href="#hello-world-in-efi-continue" aria-label="Permalink to &quot;Hello World in EFI (continue)&quot;">​</a></h3><p>So far, we ran the efi binary, but we didn&#39;t print &quot;Hello World&quot; as we promised. So let&#39;s just do exactly that.</p><p>To do that, we can&#39;t use <code>iostream</code> or <code>stdio.h</code>, since there&#39;s no OS outside the UEFI environment there&#39;s no implementation of those headers, but we know that UEFI gave us two paramters in our entry point. Maybe that could help us?</p><p>And the answer is yes, the UEFI has started the screen and knows how to write something to the console, the pointer to <code>EFI_SYSTEM_TABLE</code> contains routines (function pointers) that we can call to perform some actions available.</p><p>So, let&#39;s modify our <code>main.c</code> file:</p><div class="language-cpp line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdint.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">#include</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">stdbool.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">typedef</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_table_header</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> signature</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint32_t</span><span style="color:#F07178;"> revision</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint32_t</span><span style="color:#F07178;"> header_size</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint32_t</span><span style="color:#F07178;"> crc32</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint32_t</span><span style="color:#F07178;"> reserved</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_table_header</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">typedef</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">unused1</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">bool</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">output_string</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#BABED8;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint16_t</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#BABED8;font-style:italic;">string</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">unused2</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint16_t</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">unused3</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint64_t</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">unused4</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint64_t</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">unused5</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint64_t</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">clear_screen</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#BABED8;font-style:italic;">self</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">unused6</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint64_t</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">uint64_t</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(*</span><span style="color:#BABED8;">unused7</span><span style="color:#89DDFF;">)(</span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">*</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">bool</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused8</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_simple_text_output_protocol</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">typedef</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_system_table</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  efi_table_header header</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint16_t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint32_t</span><span style="color:#F07178;"> unused2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused3</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused4</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused5</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  efi_simple_text_output_protocol </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">out</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused6</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused7</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused8</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused9</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">uint64_t</span><span style="color:#F07178;"> unused10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">void</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;">unused11</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">efi_system_table</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">uint64_t</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">efi_main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">void</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">*</span><span style="color:#BABED8;font-style:italic;">handle</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">efi_system_table</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">*</span><span style="color:#BABED8;font-style:italic;">system_table</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#C792EA;">uint16_t</span><span style="color:#BABED8;"> msg[] </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">u&quot;</span><span style="color:#C3E88D;">Hello World!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#C792EA;">uint64_t</span><span style="color:#BABED8;"> status</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">   status </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> system_table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#BABED8;">out</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">clear_screen</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">system_table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#BABED8;">out</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">status </span><span style="color:#89DDFF;">!=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> status</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">   status </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> system_table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#BABED8;">out</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#82AAFF;">output_string</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">system_table</span><span style="color:#89DDFF;">-&gt;</span><span style="color:#BABED8;">out</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> msg</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">status </span><span style="color:#89DDFF;">!=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> status</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>Ok, too much to ingest. But first let&#39;s compile and run,</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">make</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">qemu-system-x86_64</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-drive</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">if=pflash,format=raw,readonly,file=/usr/share/qemu/edk2-x86_64-code.fd</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-drive</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">format=raw,file=fat:rw:</span><span style="color:#BABED8;">$PWD \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-net</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">none</span><span style="color:#BABED8;"> \</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C3E88D;">-nographic</span></span>
<span class="line"><span style="color:#FFCB6B;">Shell&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">fs0:</span></span>
<span class="line"><span style="color:#FFCB6B;">fs0:\&gt;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main.efi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Hello</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">World!</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Voila! We finally been able to write a Hello World on the UEFI console!</p><p>The code basically defines (because I wanted the code to be any dependency-free), and use the simple text io interface from the <code>EFI_SYSTEM_TABLE</code> (that is the second parameter to our entrypoint).</p><p>Where there are two important function pointers, <code>clear_screen</code> and <code>output_string</code>. It seems that accross the UEFI Specification they mostly use UCS-2 encoded strings (16-bit wide), so we define our string as unicode <code>u&quot;Hello World!&quot;</code> and pass it to the <code>output_string</code>.</p><p>That&#39;s it, now you can start whatever you want to do with UEFI, it also provides graphics and filesystem API through the same <code>EFI_SYSTEM_TABLE</code> so you can draw something or load up other binaries, kernels, and more. And that&#39;s what most UEFI implementations do, like for example <strong>grub</strong>, or other <strong>edk2 applications such as Ventoy</strong>.</p><h2 id="unified-kernel-image-uki" tabindex="-1">Unified Kernel Image (UKI) <a class="header-anchor" href="#unified-kernel-image-uki" aria-label="Permalink to &quot;Unified Kernel Image (UKI)&quot;">​</a></h2><p>Another interesting usecase of learning about UEFI is that now you can make a portable linux efi image. That basically package efi-stub, initramfs/initrd, kernel, (optionally) rootfs all in a single *.efi file. Making computer need no more than a single file to boot up a linux.</p><p>They help us in two ways,</p><ul><li>Allow a direct netboot (without a disk).</li><li>Boot up really <em>really</em> fast (ignoring middle-man like grub).</li></ul><p>Let me tell you a story, a few weeks ago, in our college, we had to create a cluster for ML purposes, where we had to boot multiple computers at once and spin up all of them to do the required things. To do this, we obviously had to create a self-configuring or self-configured image, and perform a netboot (that can be done by serving the file from any computer using simple built-in http server: <code>python3 -m http.server</code>) so that we won&#39;t have to plug the USB stick everytime to each and every of the computers out there, and also to not affect the internal disks (that&#39;s why we&#39;re doing netboot), we had to load everything in RAM. What could be better than Unified Kernel Images?</p><p>And for geeks like us as well, who don&#39;t use more than 1 OS, we don&#39;t really need the grub, and thus we can speed up our boot process by utilizing the UKI.</p><p>So, let&#39;s try building one!</p><h3 id="building-a-uki-for-currently-running-desktop-linux" tabindex="-1">Building a UKI for currently running desktop linux <a class="header-anchor" href="#building-a-uki-for-currently-running-desktop-linux" aria-label="Permalink to &quot;Building a UKI for currently running desktop linux&quot;">​</a></h3><p>Fortunately enough, the dracut generally described as &quot;a low-level tool for generating an initramfs/initrd image&quot;, supports building a UKI. So if you&#39;re on any modern linux distribution and already using dracut under the hood, you can easily adapt to UKI without much of a hassle.</p><p>To do this, first we would need a efi-stub,</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">xbps-install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gummiboot</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>and then we specify UKI configuration, in a file say <code>my-dracut-uki.conf</code>:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">uefi</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">yes</span></span>
<span class="line"><span style="color:#BABED8;">uefi_stub</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/lib/gummiboot/linuxx64.efi.stub</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>the <code>uefi=yes</code> is the main option that produces the *.efi binary, and <code>uefi_stub</code> is required do that.</p><p>Now, since grub is going to get out of the way, we also need to specify the kernel parameters here so that they are passed at the boot time.</p><p>Currently used kernel parameters can be fetched from the <code>/proc/cmdline</code> file. So let&#39;s extract them, with our bash skills:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/proc/cmdline</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">sed</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s/^\| /\n    /g</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Now copy them and place it within <code>CMDLINE=</code>, and hence our new config should look like:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">uefi</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">yes</span></span>
<span class="line"><span style="color:#BABED8;">uefi_stub</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/lib/gummiboot/linuxx64.efi.stub</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">CMDLINE</span><span style="color:#89DDFF;">=(</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">BOOT_IMAGE=/boot/vmlinuz-5.18.19_1</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">root=UUID=bb4d72db-5f94-4390-b02c-a4de5a73235f</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">ro</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">loglevel=</span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">acpi_osi=Windows 2020</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">net.ifnames=</span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">i915.enable_psr=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">intel_pstate=disable</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">nvme.noacpi=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">intel_iommu=on</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">rd.driver.pre=vfio-pci</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C3E88D;">kvm.ignore_msrs=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">kernel_cmdline</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;${</span><span style="color:#BABED8;">CMDLINE</span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">]}&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">unset</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">CMDLINE</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>After that we&#39;re ready to create and add that *.efi into our boot entry:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">dracut</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--force</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--verbose</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--kver</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">uname</span><span style="color:#C3E88D;"> -r</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--conf</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">my-dracut-uki.conf</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">linux+initramfs.efi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/boot/efi/EFI/void_custom/</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">cp</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">linux+initramfs.efi</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/boot/efi/EFI/void_custom/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">efibootmgr</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--create</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--disk</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/dev/nvme0n1</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--label</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Void Linux - Custom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--loader</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/EFI/void_custom/linux+initramfs.efi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">efibootmgr</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;"># lists boot order</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># manually set boot order making this UKI (0002) in higher priority</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">efibootmgr</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--bootorder</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0002</span><span style="color:#C3E88D;">,0001,2001,2002,2003</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Time to reboot and ensure everything works just like before, grub should be skipped and boot should happen from our new UKI <code>linux+initramfs.efi</code> image, and that will be significantly faster to boot than booting normally.</p><h2 id="instead-of-conclusion" tabindex="-1">Instead of conclusion <a class="header-anchor" href="#instead-of-conclusion" aria-label="Permalink to &quot;Instead of conclusion&quot;">​</a></h2><p>Hopefully the article have given a good insight on how computers start, UEFI firmware-descriptor (fd), *.efi image (or binaries), and how later they use everything else to make computer run fully functioning. As well as for you to set-up a test environment for running that.</p><p>UKIs are also a great way to reduce the boot-time of the system.</p><p>Working with UEFI has great potentials, there&#39;s projects like <a href="https://github.com/hartwork/grub2-theme-preview" target="_blank" rel="noreferrer">grub2-theme-preview</a> that helps you try out <a href="https://github.com/Jacksaur/Gorgeous-GRUB" target="_blank" rel="noreferrer">some great grub2-themes</a>, and you can also get started with embedded development, <a href="https://github.com/tianocore/edk2" target="_blank" rel="noreferrer">EDK2</a> is a community project for UEFI development, that is also used by <a href="https://github.com/ventoy/Ventoy" target="_blank" rel="noreferrer">Ventoy</a> a tool to create multi-boot USB with ease.</p><p>You can also make a custom portable pre-configured linux images, in a USB-drive that is loaded on the RAM using <code>root=live:&lt;URL&gt;</code> kernel parameter <a href="https://man7.org/linux/man-pages/man7/dracut.cmdline.7.html" target="_blank" rel="noreferrer">more info on dracut man page</a>, that you can plug anywhere, and it&#39;ll contain all the configurations you like immediately after boot.</p><p>Backlinks:</p><ul><li><a href="https://www.reddit.com/r/embedded/comments/13dmyqo/demystifying_uefi_article" target="_blank" rel="noreferrer">r/embedded</a> | <a href="https://www.reddit.com/r/linux/comments/13dn6he/demystifying_uefi_building_unified_kernel_images" target="_blank" rel="noreferrer">r/linux</a> | <a href="https://www.reddit.com/r/voidlinux/comments/13dn3k8/demystifying_uefi_article" target="_blank" rel="noreferrer">r/voidlinux</a></li><li><a href="https://www.linkedin.com/posts/animeshz_demystifying-uefi-activity-7062002173936644096-2qv6" target="_blank" rel="noreferrer">LinkedIn</a></li></ul><div class="quote" data-v-0d7e63f3><!--[-->Stay hungry, stay foolish.<!--]--><p style="text-align:right;" data-v-0d7e63f3>- Steve Jobs</p></div></div></div></main><footer class="VPDocFooter" data-v-7d2be7d2 data-v-f948c78d><!--[--><!--]--><div class="edit-info" data-v-f948c78d><div class="edit-link" data-v-f948c78d><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Animeshz/site/edit/main/content/blogs/demystifying-uefi.md" target="_blank" rel="noreferrer" data-v-f948c78d><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-f948c78d><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Edit this page<!--]--></a></div><div class="last-updated" data-v-f948c78d><p class="VPLastUpdated" data-v-f948c78d data-v-4f9fb653>Last updated: <time datetime="2023-10-28T17:56:37.000Z" data-v-4f9fb653></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><div class="prev-next" data-v-51d10272><div class="pager" data-v-51d10272><a class="pager-link prev" href="/site/blogs/void-linux.html" data-v-51d10272><span class="desc" data-v-51d10272>Previous page</span><span class="title" data-v-51d10272>Unmasking the hidden gems of Void Linux</span></a></div><div class="has-prev pager" data-v-51d10272><a class="pager-link next" href="/site/blogs/git.html" data-v-51d10272><span class="desc" data-v-51d10272>Next page</span><span class="title" data-v-51d10272>Learn Git - The easy way</span></a></div></div><div id="gitalk-container"></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"notes_90-99--miscellaneous_91--curation_91.01-note-taking.md\":\"7a78792e\",\"notes_90-99--miscellaneous_91--curation_91.02-awesome-resources.md\":\"26ecf531\",\"notes_90-99--miscellaneous_91--curation_91.03-awesome-projects.md\":\"81f71ebf\",\"index.md\":\"62572034\",\"blogs_linux-1.md\":\"85140245\",\"blogs_linux-2.md\":\"f952e469\",\"blogs_ml-tldr.md\":\"e4242a3f\",\"blogs_using-git-for-effective-collaboration.md\":\"dd05a0e8\",\"notes_90-99--miscellaneous_92--learnings_92.02-out-of-box.md\":\"76e877ce\",\"notes_90-99--miscellaneous_92--learnings_92.03-health.md\":\"ebf9c243\",\"blogs_index.md\":\"bf8299a9\",\"blogs_creating-yet-another-distribution-zxcv-linux-1.md\":\"34aa0169\",\"notes_90-99--miscellaneous_92--learnings_92.01-counter-intuitive.md\":\"29878e73\",\"notes_20-29--devenvironment_21--linux_21.01-zfs.md\":\"67eaeb74\",\"projects_index.md\":\"e0d3d076\",\"notes_20-29--devenvironment_22--text-editors_22.01-emacs.md\":\"21bacdd1\",\"journal_2023_july.md\":\"91c0a461\",\"blogs_working-with-binaries.md\":\"190e31aa\",\"blogs_a-critical-analysis-of-linux-landscape.md\":\"2af4a78b\",\"notes_20-29--devenvironment_21--linux_21.02-nix.md\":\"202a2a13\",\"notes_20-29--devenvironment_21--linux_21.03-cli-utilities.md\":\"71f8a019\",\"journal_index.md\":\"c2bd9f02\",\"blogs_void-linux.md\":\"cffe503e\",\"blogs_chasing-productivity-1.md\":\"33f27c1d\",\"notes_index.md\":\"c47753d1\",\"journal_2023_june.md\":\"001dc1fa\",\"blogs_demystifying-uefi.md\":\"cd8f85f0\",\"blogs_git.md\":\"d8bdbd59\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-IN\",\"dir\":\"ltr\",\"title\":\"Animesh Sahu\",\"description\":\"I write about wide-variety of untouched topics in a simplified way.\",\"base\":\"/site/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"Animesh Sahu / Home\",\"search\":{\"provider\":\"local\"},\"outline\":[2,6],\"outlineTitle\":\"Table of Contents\",\"socialLinks\":[{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-rss\\\" viewBox=\\\"0 0 16 16\\\"><path d=\\\"M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z\\\"/></svg>\"},\"link\":\"/site/atom.xml\"},{\"icon\":\"github\",\"link\":\"https://github.com/Animeshz/site\"}],\"editLink\":{\"pattern\":\"https://github.com/Animeshz/site/edit/main/content/:path\"},\"nav\":[{\"text\":\"🏠 Home\",\"link\":\"/\"},{\"text\":\"📝 Blogs\",\"link\":\"/blogs/\"},{\"text\":\"📔 Notes\",\"link\":\"/notes/\"},{\"text\":\"🚀 Projects\",\"link\":\"/projects/\"},{\"text\":\"✍🏻 Journal\",\"link\":\"/journal/\"}],\"sidebar\":{\"/notes/\":[{\"text\":\"20-29--DevEnvironment\",\"items\":[{\"text\":\"<span style=\\\"font-weight: 700;\\\">21--Linux</span>\",\"items\":[{\"text\":\"21.01-ZFS\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.01-ZFS\"},{\"text\":\"21.02-Nix\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.02-Nix\"},{\"text\":\"21.03-Cli-Utilities\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.03-Cli-Utilities\"}]},{\"text\":\"<span style=\\\"font-weight: 700;\\\">22--Text-Editors</span>\",\"items\":[{\"text\":\"22.01-Emacs\",\"link\":\"/notes/20-29--DevEnvironment/22--Text-Editors/22.01-Emacs\"}]}]},{\"text\":\"90-99--Miscellaneous\",\"items\":[{\"text\":\"<span style=\\\"font-weight: 700;\\\">91--Curation</span>\",\"items\":[{\"text\":\"91.01-Note-Taking\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.01-Note-Taking\"},{\"text\":\"91.02-Awesome-Resources\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.02-Awesome-Resources\"},{\"text\":\"91.03-Awesome-Projects\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.03-Awesome-Projects\"}]},{\"text\":\"<span style=\\\"font-weight: 700;\\\">92--Learnings</span>\",\"items\":[{\"text\":\"92.01-Counter-Intuitive\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.01-Counter-Intuitive\"},{\"text\":\"92.02-Out-Of-Box\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.02-Out-Of-Box\"},{\"text\":\"92.03-Health\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.03-Health\"}]}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>