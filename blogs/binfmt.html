<!DOCTYPE html>
<html lang="en-IN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BinFmt: The hidden secret of runtime execution | Animesh Sahu</title>
    <meta name="description" content="A kernel feature that nobody talks about.">
    <meta name="generator" content="VitePress v1.3.4">
    <link rel="preload stylesheet" href="/site/assets/style.Dj7ZZD0q.css" as="style">
    
    <script type="module" src="/site/assets/app.DRrrK8L5.js"></script>
    <link rel="modulepreload" href="/site/assets/chunks/framework.BIeOwSkr.js">
    <link rel="modulepreload" href="/site/assets/chunks/VPLocalSearchBox.Dcr2H3HP.js">
    <link rel="modulepreload" href="/site/assets/blogs_binfmt.md.wu4kKa0j.lean.js">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Klee+One:wght@600&amp;display=swap%22">
    <link rel="alternate" type="application/rss+xml" href="/site/rss.xml" title="Animesh Sahu | Sitewide RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="/site/atom.xml" title="Animesh Sahu | Sitewide Atom Feed">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a0af88ad><!--[--><!--]--><!--[--><span tabindex="-1" data-v-07f27c84></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-07f27c84> Skip to content </a><!--]--><!----><header class="VPNav" data-v-a0af88ad data-v-94b019dd><div class="VPNavBar" data-v-94b019dd data-v-6a61ff58><div class="wrapper" data-v-6a61ff58><div class="container" data-v-6a61ff58><div class="title" data-v-6a61ff58><div class="VPNavBarTitle" data-v-6a61ff58 data-v-f8ccd9b0><a class="title" href="/site/" data-v-f8ccd9b0><!--[--><!--]--><!----><span data-v-f8ccd9b0>Animesh Sahu / Home</span><!--[--><!--]--></a></div></div><div class="content" data-v-6a61ff58><div class="content-body" data-v-6a61ff58><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6a61ff58><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6a61ff58 data-v-d368eb94><span id="main-nav-aria-label" class="visually-hidden" data-v-d368eb94> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>🏠 Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/blogs/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>📝 Blogs</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/notes/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>📔 Notes</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/projects/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>🚀 Projects</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/site/journal/" tabindex="0" data-v-d368eb94 data-v-c28d206a><!--[--><span data-v-c28d206a>✍🏻 Journal</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6a61ff58 data-v-53f1d564><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-53f1d564 data-v-ead85328 data-v-fb57c1c6><span class="check" data-v-fb57c1c6><span class="icon" data-v-fb57c1c6><!--[--><span class="vpi-sun sun" data-v-ead85328></span><span class="vpi-moon moon" data-v-ead85328></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6a61ff58 data-v-ab886c99 data-v-9fbf789f><!--[--><a class="VPSocialLink no-icon" href="/site/atom.xml" aria-label target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rss" viewBox="0 0 16 16"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Animeshz/site" aria-label="github" target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6a61ff58 data-v-62d0ba9e data-v-b804da08><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b804da08><span class="vpi-more-horizontal icon" data-v-b804da08></span></button><div class="menu" data-v-b804da08><div class="VPMenu" data-v-b804da08 data-v-82d34753><!----><!--[--><!--[--><!----><div class="group" data-v-62d0ba9e><div class="item appearance" data-v-62d0ba9e><p class="label" data-v-62d0ba9e>Appearance</p><div class="appearance-action" data-v-62d0ba9e><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-62d0ba9e data-v-ead85328 data-v-fb57c1c6><span class="check" data-v-fb57c1c6><span class="icon" data-v-fb57c1c6><!--[--><span class="vpi-sun sun" data-v-ead85328></span><span class="vpi-moon moon" data-v-ead85328></span><!--]--></span></span></button></div></div></div><div class="group" data-v-62d0ba9e><div class="item social-links" data-v-62d0ba9e><div class="VPSocialLinks social-links-list" data-v-62d0ba9e data-v-9fbf789f><!--[--><a class="VPSocialLink no-icon" href="/site/atom.xml" aria-label target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-rss" viewBox="0 0 16 16"><path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z"/></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Animeshz/site" aria-label="github" target="_blank" rel="noopener" data-v-9fbf789f data-v-a6d790d0><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6a61ff58 data-v-fbc22365><span class="container" data-v-fbc22365><span class="top" data-v-fbc22365></span><span class="middle" data-v-fbc22365></span><span class="bottom" data-v-fbc22365></span></span></button></div></div></div></div><div class="divider" data-v-6a61ff58><div class="divider-line" data-v-6a61ff58></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-a0af88ad data-v-07a84835><div class="container" data-v-07a84835><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-07a84835 data-v-22d6e4e8><button data-v-22d6e4e8>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-a0af88ad data-v-3c531c71><div class="VPDoc has-aside" data-v-3c531c71 data-v-d037b72c><!--[--><!--]--><div class="container" data-v-d037b72c><div class="aside" data-v-d037b72c><div class="aside-curtain" data-v-d037b72c></div><div class="aside-container" data-v-d037b72c><div class="aside-content" data-v-d037b72c><div class="VPDocAside" data-v-d037b72c data-v-53740390><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-53740390 data-v-7c6fcd35><div class="content" data-v-7c6fcd35><div class="outline-marker" data-v-7c6fcd35></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-7c6fcd35>Table of Contents</div><ul class="VPDocOutlineItem root" data-v-7c6fcd35 data-v-5a646e56><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-53740390></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d037b72c><div class="content-container" data-v-d037b72c><!--[--><!--]--><main class="main" data-v-d037b72c><div style="position:relative;" class="vp-doc _site_blogs_binfmt" data-v-d037b72c><div><h1 id="frontmatter-title" tabindex="-1">BinFmt: The hidden secret of runtime execution <a class="header-anchor" href="#frontmatter-title" aria-label="Permalink to &quot;{{ $frontmatter.title }}&quot;">​</a></h1><!----><p>You know how a binary runs? Yes, a runtime (ld-linux)!</p><p><img src="/site/assets/runtime.BDvvmpNf.jpg" alt="Runtime"></p><p>You know what comes before runtime? Yes, a compilation process!</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> zig</span><span style="color:#C3E88D;"> cc</span><span style="color:#C3E88D;"> -o</span><span style="color:#C3E88D;"> main</span><span style="color:#C3E88D;"> main.c</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>And what about in between? Oh well...</p><h2 id="one-of-most-misunderstood-concept" tabindex="-1">One of most misunderstood concept <a class="header-anchor" href="#one-of-most-misunderstood-concept" aria-label="Permalink to &quot;One of most misunderstood concept&quot;">​</a></h2><p>Back in the days, when I was introduced to docker or somewhere around that time, I got to know about this thing called as binfmt_misc.</p><p>I was trying to make the raspberry pi a personal build server to compile x86 code (somewhat transparently) because I puffed my laptop&#39;s cooling fans (which btw is still puffed, except that I can now compile binaries without heating because I disabled cpu turbo via auto-cpufreq, and really at 100% cpu without fans the laptop just runs fine, never goes beyond 70-72C).</p><p>So, back to where we were, yes, binfmt_misc, this allowed me to run arm compiled binary in my laptop, and x86 binary in raspberry pi. Woah, that&#39;s too much, I know, let&#39;s go back a little and instead of theory, go by a practical example!</p><h2 id="running-arm-binary-transparently-in-x86-cpu" tabindex="-1">Running Arm binary transparently in x86 CPU <a class="header-anchor" href="#running-arm-binary-transparently-in-x86-cpu" aria-label="Permalink to &quot;Running Arm binary transparently in x86 CPU&quot;">​</a></h2><p>Ever wondered if you can do</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> ./my-favourite-arm-program</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>on your present laptop that&#39;s not arm?</p><p>How cool is it?</p><h3 id="install-and-register-qemu-on-binfmt-misc" tabindex="-1">Install and register qemu on binfmt_misc <a class="header-anchor" href="#install-and-register-qemu-on-binfmt-misc" aria-label="Permalink to &quot;Install and register qemu on binfmt_misc&quot;">​</a></h3><p>I&#39;m surprised the setup is just a set of basic steps, yet docs are so frustratingly bad around it.</p><p>I have automated it in a <a href="https://raw.githubusercontent.com/Animeshz/scripts/refs/heads/main/main/qemu-binfmt" target="_blank" rel="noreferrer">script</a>, you may also read it if you like.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> sudo</span><span style="color:#C3E88D;"> xbps-install</span><span style="color:#C3E88D;"> qemu-user-static</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> wget</span><span style="color:#C3E88D;"> https://github.com/Animeshz/scripts/raw/main/main/qemu-binfmt</span><span style="color:#89DDFF;"> &amp;&amp;</span><span style="color:#FFCB6B;"> chmod</span><span style="color:#C3E88D;"> +x</span><span style="color:#C3E88D;"> qemu-binfmt</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> ./qemu-binfmt</span><span style="color:#C3E88D;"> --register</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This script ad-hoc mounts the <code>binfmt_misc</code> filesystem, for persistence you may wanna add the following to your <code>/etc/fstab</code>.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">none</span><span style="color:#C3E88D;">  /proc/sys/fs/binfmt_misc</span><span style="color:#C3E88D;"> binfmt_misc</span><span style="color:#C3E88D;"> defaults</span><span style="color:#F78C6C;"> 0</span><span style="color:#F78C6C;"> 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="voila-run-non-architectural-binaries" tabindex="-1">Voila, run non-architectural binaries <a class="header-anchor" href="#voila-run-non-architectural-binaries" aria-label="Permalink to &quot;Voila, run non-architectural binaries&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Note: zig cc does not support static linking in *-gnu ABI</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> zig</span><span style="color:#C3E88D;"> cc</span><span style="color:#C3E88D;"> -o</span><span style="color:#C3E88D;"> main</span><span style="color:#C3E88D;"> main.c</span><span style="color:#C3E88D;"> -target</span><span style="color:#C3E88D;"> aarch64-linux-musl</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># OR aarch64-linux-gnu-gcc -static main.c -o main</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># OR aarch64-linux-musl-gcc -static main.c -o main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> file</span><span style="color:#C3E88D;"> ./main</span></span>
<span class="line"><span style="color:#FFCB6B;">./main:</span><span style="color:#C3E88D;"> ELF</span><span style="color:#C3E88D;"> 64-bit</span><span style="color:#C3E88D;"> LSB</span><span style="color:#C3E88D;"> executable,</span><span style="color:#C3E88D;"> ARM</span><span style="color:#C3E88D;"> aarch64,</span><span style="color:#C3E88D;"> version</span><span style="color:#F78C6C;"> 1</span><span style="color:#BABED8;"> (SYSV), statically linked, with debug_info, not stripped</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> ./main</span></span>
<span class="line"><span style="color:#FFCB6B;">Hello</span><span style="color:#C3E88D;"> World</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="a-note-on-dynamically-linked-binaries" tabindex="-1">A note on dynamically linked binaries <a class="header-anchor" href="#a-note-on-dynamically-linked-binaries" aria-label="Permalink to &quot;A note on dynamically linked binaries&quot;">​</a></h2><p>Without passing <code>-static</code> in gcc, or targeting <code>*-gnu</code> in zig cc compiler, output binary is dynamically linked:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> zig</span><span style="color:#C3E88D;"> cc</span><span style="color:#C3E88D;"> -o</span><span style="color:#C3E88D;"> main</span><span style="color:#C3E88D;"> main.c</span><span style="color:#C3E88D;"> -target</span><span style="color:#C3E88D;"> aarch64-linux-gnu</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># OR aarch64-linux-gnu-gcc main.c -o main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> file</span><span style="color:#C3E88D;"> ./main</span></span>
<span class="line"><span style="color:#FFCB6B;">./main:</span><span style="color:#C3E88D;"> ELF</span><span style="color:#C3E88D;"> 64-bit</span><span style="color:#C3E88D;"> LSB</span><span style="color:#C3E88D;"> executable,</span><span style="color:#C3E88D;"> ARM</span><span style="color:#C3E88D;"> aarch64,</span><span style="color:#C3E88D;"> version</span><span style="color:#F78C6C;"> 1</span><span style="color:#BABED8;"> (SYSV), dynamically linked, interpreter /lib/ld-linux-aarch64.so.1, </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> GNU/Linux 2.0.0, with debug_info, not stripped</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>You&#39;ll notice it requires interpreter at <code>/lib/ld-linux-aarch64.so.1</code>. And actually most other binaries are generally dynamically linked.</p><p>Running it directly will result in:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> ./main</span></span>
<span class="line"><span style="color:#FFCB6B;">qemu-aarch64-static:</span><span style="color:#C3E88D;"> Could</span><span style="color:#C3E88D;"> not</span><span style="color:#C3E88D;"> open</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#C3E88D;">/lib/ld-linux-aarch64.so.1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#C3E88D;"> No</span><span style="color:#C3E88D;"> such</span><span style="color:#C3E88D;"> file</span><span style="color:#C3E88D;"> or</span><span style="color:#C3E88D;"> directory</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In that case, there are 2 options</p><ul><li>If you have a chroot, run in that (chroot with binfmt works flawlessly).</li><li>Install libc of that architecture separately (see below).</li></ul><p>You&#39;ll need libc for particular architecture and need to pass <code>-L</code> to qemu binary (<code>qemu-aarch64</code>), or with binfmt case, you can just set env variable <code>QEMU_LD_PREFIX</code> while running.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> sudo</span><span style="color:#C3E88D;"> xbps-install</span><span style="color:#C3E88D;"> cross-aarch64-linux-gnu-libc</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> QEMU_LD_PREFIX=/usr/aarch64-linux-gnu</span><span style="color:#C3E88D;"> ./main</span></span>
<span class="line"><span style="color:#FFCB6B;">Hello</span><span style="color:#C3E88D;"> World</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="misc-info" tabindex="-1">Misc Info <a class="header-anchor" href="#misc-info" aria-label="Permalink to &quot;Misc Info&quot;">​</a></h2><h3 id="run-jar-directly" tabindex="-1">Run jar directly <a class="header-anchor" href="#run-jar-directly" aria-label="Permalink to &quot;Run jar directly&quot;">​</a></h3><p>You don&#39;t need to type <code>java</code> or <code>java -jar</code> in front of jar files every damn time.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> ./my-program.jar</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># OR</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> ./MyJava.class</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>is enough!</p><p>See <a href="https://wiki.archlinux.org/title/Binfmt_misc_for_Java" target="_blank" rel="noreferrer">[ArchWiki] Binfmt Misc for Java</a>.</p><h3 id="that-s-also-how-wsl-runs-exe" tabindex="-1">That&#39;s also how WSL runs .exe <a class="header-anchor" href="#that-s-also-how-wsl-runs-exe" aria-label="Permalink to &quot;That&#39;s also how WSL runs .exe&quot;">​</a></h3><p>This is exactly how inside of WSL (Windows Subsystem for Linux), you can execute a windows executable (.exe) from a bash shell, running inside actual emulated linux kernel.</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> clip.exe</span><span style="color:#89DDFF;"> &lt;</span><span style="color:#C3E88D;"> file.txt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="chrooting-into-raspberry-pi" tabindex="-1">Chrooting into Raspberry Pi <a class="header-anchor" href="#chrooting-into-raspberry-pi" aria-label="Permalink to &quot;Chrooting into Raspberry Pi&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight vp-code" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;"># mount raspberry pi at /mnt/rpi</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> sudo</span><span style="color:#C3E88D;"> mount</span><span style="color:#C3E88D;"> /dev/sda2</span><span style="color:#C3E88D;"> /mnt/rpi</span><span style="color:#C3E88D;"> -o</span><span style="color:#C3E88D;"> rw,uid=</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">id</span><span style="color:#C3E88D;"> -u</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">,gid=</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">id</span><span style="color:#C3E88D;"> -g</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#C3E88D;"> sudo</span><span style="color:#C3E88D;"> chroot</span><span style="color:#C3E88D;"> /mnt/rpi</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>You can perform</p><ul><li>apt update</li><li>install extra packages</li><li>or test/enable a service</li></ul><p>before even booting first time, and what not?</p><h2 id="further-reading" tabindex="-1">Further reading <a class="header-anchor" href="#further-reading" aria-label="Permalink to &quot;Further reading&quot;">​</a></h2><p>Running cross-arch binaries was one usecase, running jars as showed earlier is another, you may make e.g. <code>./screenshot-xxx.jpg</code> launch a image viewer.</p><p>See</p><ul><li><a href="https://docs.kernel.org/admin-guide/binfmt-misc.html" target="_blank" rel="noreferrer">binfmt_misc - Kernel SysAdmin Docs</a></li><li><a href="https://docs.kernel.org/admin-guide/binfmt-misc.html" target="_blank" rel="noreferrer">binfmt_misc - RedHat Docs</a></li><li>Zig made cross-compilation of C/C++ easy (<a href="https://zig.guide/working-with-c/zig-cc" target="_blank" rel="noreferrer">https://zig.guide/working-with-c/zig-cc</a>).</li><li><a href="https://ughe.github.io/2018/07/19/qemu-aarch64" target="_blank" rel="noreferrer">Qemu userspace emulation (debian)</a> - although don&#39;t follow the troubleshooting steps they&#39;re not safe (use <code>QEMU_LD_PREFIX</code> instead).</li></ul><p>Backlinks:</p><ul><li><a href="https://www.reddit.com/r/linux/comments/1g15i3h/binfmt_the_hidden_secret_of_runtime_execution" target="_blank" rel="noreferrer">r/linux</a> | <a href="https://www.reddit.com/r/voidlinux/comments/1g15iio/binfmt_the_hidden_secret_of_runtime_execution" target="_blank" rel="noreferrer">r/voidlinux</a></li><li><a href="https://www.linkedin.com/posts/animeshz_binfmt-the-hidden-secret-of-runtime-execution-activity-7250432617991290880-OsiU" target="_blank" rel="noreferrer">Linkedin</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-d037b72c data-v-eba3502e><!--[--><!--]--><div class="edit-info" data-v-eba3502e><div class="edit-link" data-v-eba3502e><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Animeshz/site/edit/main/content/blogs/binfmt.md" target="_blank" rel="noreferrer" data-v-eba3502e><!--[--><span class="vpi-square-pen edit-link-icon" data-v-eba3502e></span> Edit this page<!--]--></a></div><div class="last-updated" data-v-eba3502e><p class="VPLastUpdated" data-v-eba3502e data-v-5eaa2aa0>Last updated: <time datetime="2024-12-24T08:07:58.000Z" data-v-5eaa2aa0></time></p></div></div><!----></footer><!--[--><!--[--><!--[--><div class="prev-next" data-v-51d10272><div class="pager" data-v-51d10272><!----></div><div class="pager" data-v-51d10272><a class="pager-link next" href="/site/blogs/mono-repos-archiving-github-projects.html" data-v-51d10272><span class="desc" data-v-51d10272>Next page</span><span class="title" data-v-51d10272>Mono-Repos to the Rescue: Organizing and Archiving Old GitHub Projects</span></a></div></div><div id="gitalk-container"></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blogs_a-critical-analysis-of-linux-landscape.md\":\"Dx-WFdfC\",\"blogs_binfmt.md\":\"wu4kKa0j\",\"blogs_chasing-productivity-1.md\":\"52QXYQKW\",\"blogs_creating-yet-another-distribution-zxcv-linux-1.md\":\"CGhdf-fe\",\"blogs_demystifying-uefi.md\":\"Ymx0h5Ph\",\"blogs_git.md\":\"ilGeQcK5\",\"blogs_index.md\":\"xM_33D8u\",\"blogs_linux-1.md\":\"BOc5Q0RR\",\"blogs_linux-2.md\":\"DysQu055\",\"blogs_ml-tldr.md\":\"CkALJoyM\",\"blogs_mono-repos-archiving-github-projects.md\":\"C7iNODJ1\",\"blogs_using-git-for-effective-collaboration.md\":\"DtuAE7Yw\",\"blogs_void-linux.md\":\"DT7y33uy\",\"blogs_working-with-binaries.md\":\"DI2Pokj2\",\"index.md\":\"D05yrYMz\",\"journal_2023_july.md\":\"wa_3trMm\",\"journal_2023_june.md\":\"evbXIG_8\",\"journal_index.md\":\"Oi5VYMN7\",\"notes_20-29--devenvironment_21--linux_21.01-zfs.md\":\"BWjuUY3N\",\"notes_20-29--devenvironment_21--linux_21.02-nix.md\":\"KZnX1e0p\",\"notes_20-29--devenvironment_21--linux_21.03-cli-utilities.md\":\"CHXbxUQI\",\"notes_20-29--devenvironment_22--text-editors_22.01-emacs.md\":\"C_4GcZcy\",\"notes_90-99--miscellaneous_91--curation_91.01-note-taking.md\":\"LZMyEEIZ\",\"notes_90-99--miscellaneous_91--curation_91.02-awesome-resources.md\":\"DaQl-KbF\",\"notes_90-99--miscellaneous_91--curation_91.03-awesome-projects.md\":\"DVGCHvBi\",\"notes_90-99--miscellaneous_92--learnings_92.01-counter-intuitive.md\":\"CGIgcwX3\",\"notes_90-99--miscellaneous_92--learnings_92.02-out-of-box.md\":\"7FbmO_Ks\",\"notes_90-99--miscellaneous_92--learnings_92.03-health.md\":\"CDku70OX\",\"notes_index.md\":\"cZRmJ08G\",\"projects_index.md\":\"CW_os15y\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-IN\",\"dir\":\"ltr\",\"title\":\"Animesh Sahu\",\"description\":\"I write about wide-variety of untouched topics in a simplified way.\",\"base\":\"/site/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"siteTitle\":\"Animesh Sahu / Home\",\"search\":{\"provider\":\"local\"},\"outline\":[2,6],\"outlineTitle\":\"Table of Contents\",\"socialLinks\":[{\"icon\":{\"svg\":\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\" class=\\\"bi bi-rss\\\" viewBox=\\\"0 0 16 16\\\"><path d=\\\"M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1zm0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1z\\\"/></svg>\"},\"link\":\"/site/atom.xml\"},{\"icon\":\"github\",\"link\":\"https://github.com/Animeshz/site\"}],\"editLink\":{\"pattern\":\"https://github.com/Animeshz/site/edit/main/content/:path\"},\"nav\":[{\"text\":\"🏠 Home\",\"link\":\"/\"},{\"text\":\"📝 Blogs\",\"link\":\"/blogs/\"},{\"text\":\"📔 Notes\",\"link\":\"/notes/\"},{\"text\":\"🚀 Projects\",\"link\":\"/projects/\"},{\"text\":\"✍🏻 Journal\",\"link\":\"/journal/\"}],\"sidebar\":{\"/notes/\":[{\"text\":\"20-29--DevEnvironment\",\"items\":[{\"text\":\"<span style=\\\"font-weight: 700;\\\">21--Linux</span>\",\"items\":[{\"text\":\"21.01-ZFS\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.01-ZFS\"},{\"text\":\"21.02-Nix\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.02-Nix\"},{\"text\":\"21.03-Cli-Utilities\",\"link\":\"/notes/20-29--DevEnvironment/21--Linux/21.03-Cli-Utilities\"}]},{\"text\":\"<span style=\\\"font-weight: 700;\\\">22--Text-Editors</span>\",\"items\":[{\"text\":\"22.01-Emacs\",\"link\":\"/notes/20-29--DevEnvironment/22--Text-Editors/22.01-Emacs\"}]}]},{\"text\":\"90-99--Miscellaneous\",\"items\":[{\"text\":\"<span style=\\\"font-weight: 700;\\\">91--Curation</span>\",\"items\":[{\"text\":\"91.01-Note-Taking\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.01-Note-Taking\"},{\"text\":\"91.02-Awesome-Resources\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.02-Awesome-Resources\"},{\"text\":\"91.03-Awesome-Projects\",\"link\":\"/notes/90-99--Miscellaneous/91--Curation/91.03-Awesome-Projects\"}]},{\"text\":\"<span style=\\\"font-weight: 700;\\\">92--Learnings</span>\",\"items\":[{\"text\":\"92.01-Counter-Intuitive\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.01-Counter-Intuitive\"},{\"text\":\"92.02-Out-Of-Box\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.02-Out-Of-Box\"},{\"text\":\"92.03-Health\",\"link\":\"/notes/90-99--Miscellaneous/92--Learnings/92.03-Health\"}]}]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>