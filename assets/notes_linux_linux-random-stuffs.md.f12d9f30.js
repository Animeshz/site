import{_ as n,c as a,a as l,t as p,d as o,o as e}from"./app.3e13f74c.js";const u=JSON.parse('{"title":"Random Stuffs","description":"","frontmatter":{"title":"Random Stuffs","slug":"linux-random"},"headers":[{"level":2,"title":"Process Monitoring (/usr/bin/time)","slug":"process-monitoring-usr-bin-time","link":"#process-monitoring-usr-bin-time","children":[]},{"level":2,"title":"Advertising Linux as a Audio Sinking Device","slug":"advertising-linux-as-a-audio-sinking-device","link":"#advertising-linux-as-a-audio-sinking-device","children":[]},{"level":2,"title":"Running & Chrooting into cross-architecutre binaries","slug":"running-chrooting-into-cross-architecutre-binaries","link":"#running-chrooting-into-cross-architecutre-binaries","children":[]},{"level":2,"title":"Preparing a void root in subdirectory (with/without xbps)","slug":"preparing-a-void-root-in-subdirectory-with-without-xbps","link":"#preparing-a-void-root-in-subdirectory-with-without-xbps","children":[]}],"relativePath":"notes/linux/linux-random-stuffs.md"}'),r={name:"notes/linux/linux-random-stuffs.md"},t=o(`<h2 id="process-monitoring-usr-bin-time" tabindex="-1">Process Monitoring (/usr/bin/time) <a class="header-anchor" href="#process-monitoring-usr-bin-time" aria-hidden="true">#</a></h2><p><code>time</code> is a shell builtin which measures time taken by a process to complete its execution, its implementation depends on type of shell you&#39;re using.</p><p>We&#39;re <strong>not talking about that time</strong> here, we&#39;re talking about literally <code>/usr/bin/time</code> command (binary). It can be invoked as:</p><ul><li><code>/usr/bin/time &lt;cmd&gt;</code></li><li><code>eval $(which time) &lt;cmd&gt;</code></li><li><code>command time &lt;cmd&gt;</code></li></ul><p>in order to skip any time builtin present in the shell and run the possibly hidden time command in the system.</p><p>Its a very useful resource monitor. In the man page, its general format is described as:</p><div class="language-ruby line-numbers-mode"><button class="copy"></button><span class="lang">ruby</span><pre><code><span class="line"><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">Uuser </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">Ssystem </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">Eelapsed </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">PCPU </span><span style="color:#89DDFF;">(%</span><span style="color:#A6ACCD;">Xtext</span><span style="color:#89DDFF;">+%</span><span style="color:#A6ACCD;">Ddata </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">Mmax</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">k</span></span>
<span class="line"><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">Iinputs</span><span style="color:#89DDFF;">+%</span><span style="color:#A6ACCD;">Ooutputs </span><span style="color:#89DDFF;">(%</span><span style="color:#A6ACCD;">Fmajor</span><span style="color:#89DDFF;">+%</span><span style="color:#A6ACCD;">Rminor</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">pagefaults </span><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">Wswaps</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>It looks very cryptic, but what it really is:</p><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">TIME CPU (MEMORY_USAGE)</span></span>
<span class="line"><span style="color:#A6ACCD;">I/O (DISK_ACCESS + SHARED_MEMORY_ACCESS) DISK_WRITE_AS_MEMORY</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>There&#39;s a <a href="https://scoutapm.com/blog/understanding-page-faults-and-memory-swap-in-outs-when-should-you-worry" target="_blank" rel="noreferrer">very good article explaining PageFaults &amp; Swaps</a>, in case you want to read more about them.</p><h2 id="advertising-linux-as-a-audio-sinking-device" tabindex="-1">Advertising Linux as a Audio Sinking Device <a class="header-anchor" href="#advertising-linux-as-a-audio-sinking-device" aria-hidden="true">#</a></h2><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">bluetoothctl</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">...</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># power on</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">...</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># advertise.name FW</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">...</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;"># advertise on</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># A few yes here</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Note that these commands donot work from outside (in non-interactive mode).</p><h2 id="running-chrooting-into-cross-architecutre-binaries" tabindex="-1">Running &amp; Chrooting into cross-architecutre binaries <a class="header-anchor" href="#running-chrooting-into-cross-architecutre-binaries" aria-hidden="true">#</a></h2><p>Install <code>qemu-user-static</code> and run <a href="https://github.com/Animeshz/scripts/tree/main/main/qemu-binfmt" target="_blank" rel="noreferrer">this script</a> as superuser:</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">sudo qemu-binfmt --register</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><em>Note: This script needs to be ran again after every reboot, so making it run at startup is recommended.</em></p><h2 id="preparing-a-void-root-in-subdirectory-with-without-xbps" tabindex="-1">Preparing a void root in subdirectory (with/without xbps) <a class="header-anchor" href="#preparing-a-void-root-in-subdirectory-with-without-xbps" aria-hidden="true">#</a></h2><p>If you have xbps available, you can simply set <code>$XBPS_TARGET_ARCH</code> and specify <code>-r subdir</code> to install packages in that subdirectory.</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">XBPS_TARGET_ARCH=x86_64-musl xbps-install -r subdir -iR https://repo-default.voidlinux.org/current/musl -S base-files dash xbps</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>In case of non-void system, you can even bootstrap a small void-root without xbps. Create awk and bash script as follows, and run the bash script.</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#676E95;"># FILE: /xbps-deps-extract.awk</span></span>
<span class="line"><span style="color:#A6ACCD;">BEGIN </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    FS = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">[&lt;&gt;]</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    OFS = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">descend(node)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">isarray</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">run_depends</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> (dep </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> map</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">run_depends</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">match</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">dep, /^</span><span style="color:#89DDFF;">([</span><span style="color:#A6ACCD;">^</span><span style="color:#89DDFF;">&amp;=]</span><span style="color:#A6ACCD;">+</span><span style="color:#89DDFF;">)(&amp;</span><span style="color:#A6ACCD;">gt</span><span style="color:#89DDFF;">;|&amp;</span><span style="color:#A6ACCD;">lt</span><span style="color:#89DDFF;">;)?(</span><span style="color:#A6ACCD;">=</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">-</span><span style="color:#89DDFF;">)[</span><span style="color:#A6ACCD;">0-9</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">/, depname</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            descend</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">depname</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(!</span><span style="color:#A6ACCD;">uniq</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">++</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> print map</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">filename-sha256</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">, map</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pkgver</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">/^\\t</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/ </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> pkg = </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">3 }</span></span>
<span class="line"><span style="color:#A6ACCD;">/^\\t\\t</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/ </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> field = </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">3</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> getline</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">($</span><span style="color:#A6ACCD;">3 </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">= </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> map</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">pkg</span><span style="color:#89DDFF;">][</span><span style="color:#A6ACCD;">field</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> = </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">3</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> }</span></span>
<span class="line"><span style="color:#A6ACCD;">/^\\t\\t\\t</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">.</span><span style="color:#89DDFF;">*&gt;</span><span style="color:#A6ACCD;">$/ </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> map</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">pkg</span><span style="color:#89DDFF;">][</span><span style="color:#A6ACCD;">field</span><span style="color:#89DDFF;">][$</span><span style="color:#A6ACCD;">3</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">END </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    descend</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">FOR</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;"># FILE: /xbps-bootstrap</span></span>
<span class="line"><span style="color:#676E95;">#!/usr/bin/env bash</span></span>
<span class="line"><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> -e  </span><span style="color:#676E95;"># Exit immediately if any part of script fails</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">EUID </span><span style="color:#89DDFF;">-ne</span><span style="color:#A6ACCD;"> 0 </span><span style="color:#89DDFF;">]];</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">then</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&gt;&amp;2</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">This script must be run as root</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">exit</span><span style="color:#A6ACCD;"> 1</span></span>
<span class="line"><span style="color:#89DDFF;">fi</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">XBPS_MIRROR=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://mirrors.dotsrc.org/voidlinux/current/musl</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">XBPS_TARGET_ARCH=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">x86_64-musl</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">CURRENT_DIR=</span><span style="color:#89DDFF;">$(</span><span style="color:#C3E88D;">cd -- </span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#C3E88D;"> dirname -- </span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">BASH_SOURCE</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">0</span><span style="color:#89DDFF;">]}&quot;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">)&quot;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&amp;&gt;</span><span style="color:#C3E88D;"> /dev/null </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#C3E88D;"> pwd</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">TMP_DIR=/var/run/pun/initial_setup</span></span>
<span class="line"><span style="color:#A6ACCD;">BUILD_CACHE_DIR=/pun/build_cache</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">TMP_DIR</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">mkdir -p </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">BUILD_CACHE_DIR</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">pushd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">TMP_DIR</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">wget -cq --show-progress </span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">XBPS_MIRROR</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">XBPS_TARGET_ARCH</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">-repodata</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">tar xf </span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">XBPS_TARGET_ARCH</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">-repodata</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">install_pkg</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  awk -v FOR=</span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> -f </span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">CURRENT_DIR</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/xbps-deps-extract.awk</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> index.plist </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> install-deps.txt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;"># I know not the best way: terminal output becomes clogged as multiple writes to stdout</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">read</span><span style="color:#A6ACCD;"> checksum pkgver</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">    filename=</span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">pkgver</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">XBPS_TARGET_ARCH</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.xbps</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    wget -cq --show-progress </span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">XBPS_MIRROR</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">}&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">printf</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%s %s\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">checksum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;$</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> sha256sum --check </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">&amp;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">done</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> install-deps.txt</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">wait</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">pushd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">BUILD_CACHE_DIR</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">read</span><span style="color:#A6ACCD;"> checksum pkgver</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">    filename=</span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">pkgver</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">XBPS_TARGET_ARCH</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">.xbps</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    tar xf </span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">TMP_DIR</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> ./INSTALL </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-x</span><span style="color:#A6ACCD;"> INSTALL </span><span style="color:#89DDFF;">]]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> ./INSTALL pre</span></span>
<span class="line"><span style="color:#A6ACCD;">    tar xf </span><span style="color:#89DDFF;">&quot;\${</span><span style="color:#A6ACCD;">TMP_DIR</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> --exclude-from </span><span style="color:#89DDFF;">&lt;(</span><span style="color:#C3E88D;">printf </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./%s\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">REMOVE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">INSTALL</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">props.plist</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">files.plist</span><span style="color:#89DDFF;">&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">[[</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-x</span><span style="color:#A6ACCD;"> INSTALL </span><span style="color:#89DDFF;">]]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> ./INSTALL post</span></span>
<span class="line"><span style="color:#A6ACCD;">    rm </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">BUILD_CACHE_DIR</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/INSTALL </span><span style="color:#89DDFF;">2&gt;</span><span style="color:#A6ACCD;">/dev/null </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">done</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">TMP_DIR</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">/install-deps.txt</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">popd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> pkg </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> base-files dash xbps</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">  install_pkg </span><span style="color:#89DDFF;">$</span><span style="color:#A6ACCD;">pkg</span></span>
<span class="line"><span style="color:#89DDFF;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">popd</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/dev/null</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p>Now you should be able to run the commands present in subdir in an isolated environment (subdir as its root) via chroot:</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#A6ACCD;">sudo chroot subdir dash</span></span>
<span class="line"><span style="color:#A6ACCD;">sudo chroot subdir xbps-install --help</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Be sure to read <a href="/site/blogs/working-with-binaries.html#let-s-go">Running binaries in seperate root</a> to make them work without chroot.</p>`,25);function c(s,D,i,y,F,A){return e(),a("div",null,[l("h1",null,p(s.$frontmatter.title),1),t])}const b=n(r,[["render",c]]);export{u as __pageData,b as default};
