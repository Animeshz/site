import{_ as s,o as e,c as a,V as n}from"./chunks/framework.d1c50dd7.js";const u=JSON.parse('{"title":"21.02 Nix","description":"","frontmatter":{},"headers":[],"relativePath":"notes/20-29--DevEnvironment/21--Linux/21.02-Nix.md","filePath":"notes/20-29--DevEnvironment/21--Linux/21.02-Nix.md","lastUpdated":1689087150000}'),l={name:"notes/20-29--DevEnvironment/21--Linux/21.02-Nix.md"},o=n(`<h1 id="_21-02-nix" tabindex="-1">21.02 Nix <a class="header-anchor" href="#_21-02-nix" aria-label="Permalink to &quot;21.02 Nix&quot;">​</a></h1><p><a href="https://nixos.org" target="_blank" rel="noreferrer">Nix</a> can produce highly reproducible environment, that means you can replicate <a href="https://github.com/Animeshz/linux-desktop" target="_blank" rel="noreferrer">my setup</a> in your system without fighting for errors ever again.</p><p>Term nix can refer to <a href="https://learnxinyminutes.com/docs/nix" target="_blank" rel="noreferrer">declarative nix language</a> or <a href="https://github.com/NixOS/nix" target="_blank" rel="noreferrer">imperative nix package manager</a>.</p><p>TODO.</p><p>INCOMPLETE. JUST MAKING NOTES FOR MY OWN FOR THINGS I DON&#39;T WANT TO REMEMBER FOR NOW.</p><h2 id="useful-commands" tabindex="-1">Useful Commands <a class="header-anchor" href="#useful-commands" aria-label="Permalink to &quot;Useful Commands&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nix</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">show-config</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># Shows dump of $XDG_CONFIG_HOME/nix/nix.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="really-really-remove-something-from-system" tabindex="-1">Really really remove something from system <a class="header-anchor" href="#really-really-remove-something-from-system" aria-label="Permalink to &quot;Really really remove something from system&quot;">​</a></h2><p>Nix is sometimes too troublesome to deal with increasing space usage, due to the design philosophy.</p><p>To remove something for sure, as described in <a href="https://github.com/NixOS/nix/issues/6141" target="_blank" rel="noreferrer">nix#6141</a>,</p><p>Remove frm cfg &amp; switch generation, then</p><ul><li>delete all generations manually using bash making sure current gen doesn&#39;t delete<div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/.local/share/nix/profiles</span></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">home-manager-</span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># &lt;TAB&gt; &lt;C-DELETE-last-entry&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li>garbage collect<div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nix-collect-garbage</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li>delete referrer<div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nix-store</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--query</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--referrers</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/nix/store/21n7lgbhyahwg4agxgwnf0h9i4b4xvxl-ruby3.1.4-puppet-7.26.0</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">xargs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nix-store</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--delete</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li>delete referrer closures<div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">nix-store</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--query</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">--referrers-closure</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/nix/store/2ka0zrmv9gl194f286r4k0jb6m5pc78v-ruby3.1.4-semantic_puppet-1.1.0/</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">xargs</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nix-store</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--delete</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li>delete ignoring liveness<div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nix</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">store</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/nix/store/2ka0zrmv9gl194f286r4k0jb6m5pc78v-ruby3.1.4-semantic_puppet-1.1.0/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--ignore-liveness</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--extra-experimental-features</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nix-command flakes</span><span style="color:#89DDFF;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li>If yet still not removable, reboot and try all steps again, sometimes if something is loaded in memory (/proc/mmap) nix thinks it shouldn&#39;t be removed no matter what.</li></ul>`,12),r=[o];function t(p,i,c,m,d,y){return e(),a("div",null,r)}const h=s(l,[["render",t]]);export{u as __pageData,h as default};
