<!DOCTYPE html>
<html class="scroll-smooth">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
              integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
              crossorigin="anonymous"
              referrerpolicy="no-referrer"/>
        <link rel="stylesheet"
              href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site/assets/css/generated/main.css"/>
        <script defer src="https://unpkg.com/darkreader@4.9.52/darkreader.js"></script>
        <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
        
    </head>
    <body class="min-h-screen flex flex-col child:child:px-8">
        <div class="flex-1 flex flex-row child:pt-8">
            <div class="flex-1 min-w-0 hidden md:block mt-14">
                <!-- Left Sidebar -->
                
    
    <div x-data="{ toc: true }" class="sticky top-0 pt-8">
        <button class="hover:text-green-400" x-on:click="toc = !toc">
            <i class="fas fa-chevron-down text-green-400 transision duration-300" aria-hidden="true" x-bind:style="{ 'transform': toc ? '' : 'rotate(-90deg)' }"></i>
            <span class="px-2">Table of Contents</span>
        </button>
        <div id="toc" class="text-lg mt-2 break-words transition-[max-height] duration-300 ease-in-out overflow-hidden"
            x-bind:style="{ 'max-height': toc ? height($el) : '0px' }">
            <ul>
            
                <li>
                    <a href="https://animeshz.github.io/site/notes/nix/#nix-an-introduction">Nix - An introduction</a>
                </li>
                
            
                <li>
                    <a href="https://animeshz.github.io/site/notes/nix/#installing-nix">Installing Nix</a>
                </li>
                
                    <ul>
                        
                            <li>
                                <a href="https://animeshz.github.io/site/notes/nix/#some-useful-fish-abbreviations">Some useful fish abbreviations</a>
                            </li>
                            
                        
                    </ul>
                
            
                <li>
                    <a href="https://animeshz.github.io/site/notes/nix/#opiniated-configuration">Opiniated Configuration</a>
                </li>
                
            
                <li>
                    <a href="https://animeshz.github.io/site/notes/nix/#learning-nix">Learning Nix</a>
                </li>
                
            
                <li>
                    <a href="https://animeshz.github.io/site/notes/nix/#nix-flakes">Nix Flakes</a>
                </li>
                
            
                <li>
                    <a href="https://animeshz.github.io/site/notes/nix/#extra-personal-favourites">Extra (Personal Favourites)</a>
                </li>
                
            
            </ul>
        </div>
    </div>
    

            </div>
            <div id="main" class="prose w-[48rem] max-w-none mt-14">
                <!-- Main Content -->
                
    <h1 class="not-prose text-5xl font-extrabold text-green-400"><a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;notes&#x2F;nix&#x2F;" class="decoration-none">Nix - Building a Robust Dev Environment</a></h1>
    <h2 id="nix-an-introduction">Nix - An introduction</h2>
<p>Nix, a package manager and a configuration language (not just specific to NixOS), to make a reproducible self-contained builds, from flat text-files.</p>
<p>Its primary repository (called <a href="https://search.nixos.org/packages">nixpkgs</a>) is quite like a AUR but without the restriction to use a particular distro in order to use it, it runs on <em>all the Linux distros available on the planet</em> as well as on the MacOS.</p>
<p>Plus unlike AUR, it uses a binary cache by which you can install pkgs directly (without hours of build). Its over 220TB large and distributed via CDN.</p>
<p>If something went wrong <em><strong>including any system level modifications</strong></em> from nix, can be easily rolled back using nix profiles (created automatically at every change).</p>
<p>This page contains my notes while installing nix on Void Linux.</p>
<h2 id="installing-nix">Installing Nix</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">sudo</span><span> xbps-install nix             </span><span style="color:#65737e;"># 1
</span><span style="color:#bf616a;">sudo</span><span> usermod</span><span style="color:#bf616a;"> -aG</span><span> nixbld (whoami)  </span><span style="color:#65737e;"># logout &amp; login
</span><span>
</span><span style="color:#bf616a;">sudo</span><span> ln</span><span style="color:#bf616a;"> -s</span><span> /etc/sv/nix-daemon /var/service
</span><span style="color:#bf616a;">nix-channel --add</span><span> http://nixos.org/channels/nixpkgs-unstable nixpkgs
</span><span style="color:#bf616a;">nix-channel --update
</span><span>
</span><span style="color:#65737e;"># Specific to fish shell
</span><span style="color:#bf616a;">curl -sL</span><span> https://git.io/fisher | </span><span style="color:#96b5b4;">source </span><span>&amp;&amp; </span><span style="color:#bf616a;">fisher</span><span> install jorgebucaran/fisher
</span><span style="color:#bf616a;">fisher</span><span> install lilyball/nix-env.fish
</span><span style="color:#bf616a;">sudo</span><span> mkdir</span><span style="color:#bf616a;"> -p</span><span> /nix/var/nix/profiles/default/etc/profile.d
</span><span style="color:#bf616a;">sudo</span><span> cp /etc/profile.d/nix.sh /nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh
</span><span style="color:#65737e;"># re-open shell
</span><span>
</span><span style="color:#65737e;"># To confirm
</span><span style="color:#96b5b4;">echo </span><span>$</span><span style="color:#bf616a;">NIX_PATH
</span><span style="color:#bf616a;">nix-env --version
</span><span style="color:#bf616a;">nix-shell -p</span><span> hello   </span><span style="color:#65737e;"># run &#39;hello&#39; in the new shell
</span></code></pre>
<p><sub>1. Installation with xbps just makes uninstall process easier (otherwise run the script in their website &amp; create a runit service with one line: <code>exec /nix/var/nix/profiles/default/bin/nix-daemon</code>)</sub></p>
<h3 id="some-useful-fish-abbreviations">Some useful fish abbreviations</h3>
<pre data-lang="fish" style="background-color:#2b303b;color:#c0c5ce;" class="language-fish "><code class="language-fish" data-lang="fish"><span style="color:#65737e;"># abbr ne &#39;nix-env&#39;
</span><span style="color:#bf616a;">abbr </span><span>nc &#39;</span><span style="color:#a3be8c;">nix-channel --add</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>nu &#39;</span><span style="color:#a3be8c;">nix-channel --update</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>ns &#39;</span><span style="color:#a3be8c;">nix-shell</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>ng &#39;</span><span style="color:#a3be8c;">nix-collect-garbage -d</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>no &#39;</span><span style="color:#a3be8c;">nix store optimise</span><span>&#39;
</span><span>
</span><span style="color:#bf616a;">abbr </span><span>nr &#39;</span><span style="color:#a3be8c;">nix registry list</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>npi &#39;</span><span style="color:#a3be8c;">nix profile install</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>npr &#39;</span><span style="color:#a3be8c;">nix profile remove</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>nph &#39;</span><span style="color:#a3be8c;">nix profile history</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>nproll &#39;</span><span style="color:#a3be8c;">nix profile rollback --to</span><span>&#39;
</span><span>
</span><span style="color:#bf616a;">abbr </span><span>nfs &#39;</span><span style="color:#a3be8c;">nix shell</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>nfr &#39;</span><span style="color:#a3be8c;">nix run</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>nfd &#39;</span><span style="color:#a3be8c;">nix develop</span><span>&#39;
</span><span>
</span><span style="color:#bf616a;">abbr </span><span>nfshow &#39;</span><span style="color:#a3be8c;">nix flake show</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>nfmeta &#39;</span><span style="color:#a3be8c;">nix flake metadata</span><span>&#39;
</span><span style="color:#bf616a;">abbr </span><span>nfpinf &#39;</span><span style="color:#a3be8c;">nix path-info -rsSh</span><span>&#39;
</span></code></pre>
<h2 id="opiniated-configuration">Opiniated Configuration</h2>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#96b5b4;">echo </span><span>&#39;</span><span style="color:#a3be8c;">max-jobs = auto</span><span>&#39; | </span><span style="color:#bf616a;">sudo</span><span> tee</span><span style="color:#bf616a;"> --append</span><span> /etc/nix/nix.conf   </span><span style="color:#65737e;"># Use multi-threads
</span><span style="color:#96b5b4;">echo </span><span>&#39;</span><span style="color:#a3be8c;">experimental-features = nix-command flakes</span><span>&#39; | </span><span style="color:#bf616a;">sudo</span><span> tee</span><span style="color:#bf616a;"> --append</span><span> /etc/nix/nix.conf </span><span style="color:#65737e;"># Use flakes
</span></code></pre>
<h2 id="learning-nix">Learning Nix</h2>
<p><a href="https://nix-tutorial.gitlabpages.inria.fr/nix-tutorial/getting-started.html">Nix - Getting started</a><br>
<a href="https://github.com/justinwoo/nix-shorts/blob/master/posts/your-first-derivation.md">NixShorts - Your First Derivation</a><br>
<a href="https://learnxinyminutes.com/docs/nix">LearnXinYminutes - Nix</a>
<a href="https://ryantm.github.io/nixpkgs/functions/library/strings">Nix - The cool stdLib</a></p>
<p><a href="https://www.youtube.com/watch?v=qjq2wVEpSsA">This video</a> talks in-depth how Nix and NixOS are so close to be perfect.</p>
<p><a href="https://unix.stackexchange.com/questions/369234/how-to-configure-a-nix-environment-outside-of-nixos">Using file to manage packages - non-nixos users</a>
<a href="https://discourse.nixos.org/t/poetry2nix-flakes-add-runtime-dependencies/15930/3">Declaring dependencies</a><br>
<a href="https://discourse.nixos.org/t/how-to-create-a-script-with-dependencies/7970/6">Runtime dependencies in shell scripts</a> or <a href="https://gist.github.com/CMCDragonkai/9b65cbb1989913555c203f4fa9c23374">makeWrapper on nixpkgs</a> or <a href="https://github.com/nix-community/home-manager/blob/master/home-manager/default.nix">substituteInPlace in home-manager</a></p>
<p>Misc:</p>
<p><a href="https://nixos.wiki/wiki/NixOS_modules">Nix Modules - Docs</a> | <a href="https://github.com/NixOS/nixpkgs/blob/master/lib/modules.nix#L373">nix_modules src</a><br>
<a href="https://nixos.org/guides/nix-pills/our-first-derivation.html">Nix Pills</a></p>
<h2 id="nix-flakes">Nix Flakes</h2>
<p>A new de-facto standard to write nix files, making everything clean and easier to understand. Quite like a rust crate, also forms a lockfile for automated reproducibility.</p>
<ul>
<li>Learn more:<br>
<a href="https://edolstra.github.io/talks/nixcon-oct-2019.pdf">https://edolstra.github.io/talks/nixcon-oct-2019.pdf</a><br>
<a href="https://serokell.io/blog/practical-nix-flakes">https://serokell.io/blog/practical-nix-flakes</a><br>
<a href="https://ianthehenry.com/posts/how-to-learn-nix/flakes">https://ianthehenry.com/posts/how-to-learn-nix/flakes</a></li>
<li>Official Docs: <a href="https://nixos.wiki/wiki/Flakes">https://nixos.wiki/wiki/Flakes</a></li>
</ul>
<p><a href="https://blog.ysndr.de/posts/guides/2021-12-01-nix-shells/#tldr-nix-develop">The new <code>nix *</code> commands vs the traditional <code>nix-*</code> commands</a></p>
<p>&lt;!- Home Manager: https://www.youtube.com/watch?v=OgUvDXxHlLs ---&gt;</p>
<h2 id="extra-personal-favourites">Extra (Personal Favourites)</h2>
<ul>
<li><a href="https://discourse.nixos.org/t/what-does-mkdefault-do-exactly/9028/2">lib.mkDefault</a></li>
<li><a href="https://www.reddit.com/r/NixOS/comments/j5pa9o/getting_all_configs_from_folder">Include all nix modules under a path</a></li>
<li><a href="https://github.com/nuxshed/dotfiles/blob/main/flake.nix">Sample config from a long time nix user</a></li>
<li><a href="https://nixos.wiki/wiki/Binary_Cache">Setup Binary Cache</a> + <a href="https://nixos.org/manual/nix/stable/command-ref/conf-file.html">Use it</a></li>
<li><a href="https://nixos.org/manual/nix/unstable/command-ref/new-cli/nix3-path-info.html">nix path-info command</a></li>
</ul>


            </div>
            <div x-data="{ open: true, full: true, share_icons: false }"
                 class="flex-1 min-w-0 sticky top-0 self-start h-screen hidden md:flex flex-col">
                <!-- Header -->
                
                    <nav class="flex flex-row items-center justify-end child:inline-block group">
                        <!-- NavBar -->
                        <ul x-on:mouseover="full = true"
                            x-init="full = is_top()"
                            x-on:mouseout="full = is_top()"
                            x-on:scroll.document="full = is_top()"
                            x-on:resize.document="full = is_top()"
                            x-bind:style="{ 'max-width': open ? (full ? width($el) : parent_width($el)) : 0 }"
                            class="list-none bg-white rounded py-1 ml-[-100vw] z-10 overflow-hidden text-sm child:text-right child:inline-block child:mx-2 hover:child:text-pink-400 dark:hover:child:text-pink-200 transition-[max-width] whitespace-nowrap duration-300 ease-in-out">
                            
                            <li>
                                <a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;">Home</a>
                            </li>
                            
                                
                                <li>
                                    <a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;blog&#x2F;">Blogs</a>
                                </li>
                            
                                
                                <li>
                                    <a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;awesome&#x2F;">Awesome</a>
                                </li>
                            
                                
                                <li>
                                    <a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;notes&#x2F;">Notes</a>
                                </li>
                            
                                
                                <li>
                                    <a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;point_of_interest&#x2F;">Point of Interest</a>
                                </li>
                            
                                
                                <li>
                                    <a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;setup&#x2F;">Setup</a>
                                </li>
                            
                                
                                <li>
                                    <a href="https:&#x2F;&#x2F;animeshz.github.io&#x2F;site&#x2F;contact&#x2F;">Contact</a>
                                </li>
                            
                        </ul>
                        <!-- Hamburger -->
                        <button x-on:click="open = !open" id="menu-toggle" class="ml-3">
                            <i class="fas fa-bars fa-lg text-pink-600"></i>
                        </button>
                    </nav>
                    <!-- Page Actions -->
                    <div id="action-nav"
                         class="transition-[max-height] duration-300 ease-in-out overflow-hidden"
                         x-bind:style="{ 'max-height': open ? height($el) : '0px' }">
                        <div class="flex flex-row flex-wrap space-x-5 justify-end mt-7 hover:child:text-pink-300">
                            <!-- Action Text -->
                            <i x-ref="action_text" class="text-sm"></i>  
                            <!-- Action Icons -->
                            
                                
                                
                            
                            <a href="#"
                               aria-label="Top of Page"
                               x-on:click.prevent="window.scrollTo({ top: 0, behavior: 'smooth' })"
                               x-on:mouseover="$refs.action_text.innerText = 'Back to top'"
                               x-on:mouseout="$refs.action_text.innerText = ''">
                                <i class="fas fa-chevron-up" aria-hidden="true"></i>
                            </a>
                            <a href="#"
                               aria-label="Switch Theme"
                               x-init="theme_init($el)"
                               x-on:click.prevent="theme_toggle"
                               x-on:mouseover="$refs.action_text.innerText = 'Toggle dark theme'"
                               x-on:mouseout="$refs.action_text.innerText = ''">
                                <i class="fas fa-moon" aria-hidden="true"></i>
                            </a>
                            <a href="#"
                               aria-label="Share"
                               x-on:click.prevent="share_icons = !share_icons"
                               x-on:mouseover="$refs.action_text.innerText = 'Share post'"
                               x-on:mouseout="$refs.action_text.innerText = ''">
                                <i class="fas fa-share-alt" aria-hidden="true"></i>
                            </a>
                        </div>
                    </div>
                    <!-- Share Icons -->
                    <ul id="share-icons"
                        class="transition-[max-height] duration-300 ease-in-out mt-1 mb-4 overflow-hidden text-right"
                        style="max-height: 0px"
                        x-effect="if (!open) share_icons = false"
                        x-bind:style="{ 'max-height': share_icons ? height($el) : '0px' }">
                        <li>
                            <a class="icon" href="" aria-label="Facebook">
                                <i class="fab fa-facebook" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <a class="icon" href="" aria-label="Twitter">
                                <i class="fab fa-twitter" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <a class="icon" href="" aria-label="Linkedin">
                                <i class="fab fa-linkedin" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <a class="icon" href="" aria-label="Pinterest">
                                <i class="fab fa-pinterest" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <!-- href="mailto:?subject=&body=Check out this article: " -->
                            <a class="icon" aria-label="Email">
                                <i class="fas fa-envelope" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <a class="icon" href="" aria-label="Pocket">
                                <i class="fab fa-get-pocket" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <a class="icon" href="" aria-label="reddit">
                                <i class="fab fa-reddit" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <a class="icon" href="" aria-label="Tumblr">
                                <i class="fab fa-tumblr" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li>
                            <a class="icon" href="" aria-label="Hacker News">
                                <i class="fab fa-hacker-news" aria-hidden="true"></i>
                            </a>
                        </li>
                    </ul>
                
                <!-- Right Sidebar -->
                <div class="overflow-y-auto break-words flex-1">
                    

                </div>
            </div>
        </div>
        
            
            <div class="mb-14"></div>
        
        <script>
            function theme_init(e) {
                if (localStorage.theme === 'dark' ||
                    (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                    e.firstElementChild.classList.remove('fa-moon');
                    e.firstElementChild.classList.add('fa-sun');

                    DarkReader.enable({
                        brDarkReaderightness: 100,
                        contrast: 90,
                        sepia: 10
                    });
                }
            }

            function theme_toggle(evt) {
                if (document.documentElement.classList.toggle('dark')) {
                    localStorage.theme = 'dark';
                    evt.target.classList.remove('fa-moon');
                    evt.target.classList.add('fa-sun');

                    DarkReader.enable({
                        brDarkReaderightness: 100,
                        contrast: 90,
                        sepia: 10
                    });
                } else {
                    localStorage.theme = 'light';
                    evt.target.classList.remove('fa-sun');
                    evt.target.classList.add('fa-moon');

                    DarkReader.disable();
                }
            }

            function is_top() {
                return document.documentElement.scrollTop == 0;
            }
            function height(e) {
                return e.scrollHeight + 'px';
            }
            function width(e) {
                return e.scrollWidth + 'px';
            }
            function parent_width(e) {
                return e.parentElement.scrollWidth + 'px';
            }
        </script>
    </body>
</html>
